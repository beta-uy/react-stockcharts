{"version":3,"sources":["../../src/lib/ChartCanvas.js"],"names":["log","CANDIDATES_FOR_RESET","shouldResetChart","thisProps","nextProps","every","result","key","getCursorStyle","tooltipStyle","getDimensions","props","height","margin","top","bottom","width","left","right","getXScaleDirection","flipXScale","calculateFullData","fullData","data","plotFull","xScale","clamp","pointsPerPxThreshold","xAccessor","displayXAccessor","minPointsPerPxThreshold","useWholeData","identity","filterData","copy","resetChart","firstCalculation","process","env","NODE_ENV","state","calculateState","initialPlotData","plotData","postCalculator","children","dimensions","chartConfig","domain","updateChart","newState","initialXScale","lastItemWasVisible","initialChartConfig","lastItem","start","end","padding","maintainPointsPerPixelOnResize","direction","updatedXScale","setXRange","range","rangeStart","rangeEnd","newRangeStart","newRangeEnd","newDomainExtent","newStart","lastItemX","response","fallbackStart","fallbackEnd","dx","map","x","invert","newEnd","inputXAccesor","xExtentsProp","xExtents","i","length","prev","curr","Error","extent","d","each","rangeRoundPoints","isNaN","pinchCoordinates","pinch","touch1Pos","touch2Pos","topLeft","Math","min","bottomRight","max","ChartCanvas","getDataInfo","bind","getCanvasContexts","handleMouseMove","handleMouseEnter","handleMouseLeave","handleZoom","handlePinchZoom","handlePinchZoomEnd","handlePan","handlePanEnd","handleClick","handleMouseDown","handleDoubleClick","handleContextMenu","handleDragStart","handleDrag","handleDragEnd","panHelper","pinchZoomHelper","xAxisZoom","yAxisZoom","resetYDomain","calculateStateForDomain","generateSubscriptionId","draw","redraw","getAllPanConditions","subscriptions","subscribe","unsubscribe","amIOnTop","saveEventCaptureNode","saveCanvasContainerNode","setCursorClass","getMutableState","interactiveState","panInProgress","mutableState","lastSubscriptionId","node","eventCaptureNode","canvasContainerNode","canvases","axes","mouseCoord","ratio","bg","id","rest","getPanConditions","draggable","panEnabled","concat","filter","className","dragableComponents","mouseXY","e","currentCharts","currentItem","triggerEvent","newDomain","currentPlotData","currentDomain","beforePlotData","updatedScale","initialPinch","finalPinch","initialPinchXScale","iTL","iBR","fTL","fBR","xDash","round","yDash","y","cancelDrag","waitingForPinchZoomAnimationFrame","requestAnimationFrame","clearBothCanvas","trigger","clearThreeCanvas","firstItem","onLoadMore","setState","zoomDirection","zoomMultiplier","zoomAnchor","item","cx","c","show","chartId","yScale","yPanEnabled","type","forEach","listener","force","chartsToPan","dy","hackyWayToStopPanBeyondBounds__plotData","hackyWayToStopPanBeyondBounds__domain","mousePosition","panStartXScale","dxdy","waitingForPanAnimationFrame","inputType","waitingForMouseMoveAnimationFrame","prevMouseXY","clearMouseCanvas","startPos","chartCanvasType","reset","interaction","isInteractionEnabled","prevLastItem","calculatedState","changed","newChartConfig","realYDomain","zIndex","defaultFocus","mouseMoveEvent","panEvent","zoomEvent","gradientColor","useCrossHairStyleCursor","onSelect","cursorStyle","cursor","position","idx","disableInteraction","Component","propTypes","PropTypes","number","isRequired","object","oneOf","array","func","oneOfType","string","seriesName","bool","shape","propName","console","warn","defaultProps","noop","mouseBasedZoomAnchor","childContextTypes","arrayOf","origin","yExtents","yExtentsProvider","mouseCoordinates","at","format","ohlcv","date","open","high","low","close","volume"],"mappings":";;;;;;;;;;;;AAiBA;;AAMA;;AAvBA;;;;AACA;;;;AACA;;AAEA;;AAcA;;AAOA;;AAOA;;;;AAEA;;;;AACA;;;;;;;;;;;;;;AAEA,IAAMA,MAAM,sBAAU,aAAV,CAAZ;;AAEA,IAAMC,uBAAuB,CAC5B,YAD4B,CAA7B;;AAMA,SAASC,gBAAT,CAA0BC,SAA1B,EAAqCC,SAArC,EAAgD;AAC/C,QAAO,CAACH,qBAAqBI,KAArB,CAA2B,eAAO;AACzC,MAAMC,SAAS,yBAAaH,UAAUI,GAAV,CAAb,EAA6BH,UAAUG,GAAV,CAA7B,CAAf;AACA;AACA,SAAOD,MAAP;AACA,EAJO,CAAR;AAKA;;AAED,SAASE,cAAT,GAA0B;AACzB,KAAMC,05BAAN;AAwCA,QAAO;AAAA;AAAA,IAAO,MAAK,UAAZ;AAAwBA;AAAxB,EAAP;AACA;;AAED,SAASC,aAAT,CAAuBC,KAAvB,EAA8B;AAC7B,QAAO;AACNC,UAAQD,MAAMC,MAAN,GAAeD,MAAME,MAAN,CAAaC,GAA5B,GAAkCH,MAAME,MAAN,CAAaE,MADjD;AAENC,SAAOL,MAAMK,KAAN,GAAcL,MAAME,MAAN,CAAaI,IAA3B,GAAkCN,MAAME,MAAN,CAAaK;AAFhD,EAAP;AAIA;;AAED,SAASC,kBAAT,CAA4BC,UAA5B,EAAwC;AACvC,QAAOA,aAAa,CAAC,CAAd,GAAkB,CAAzB;AACA;;AAED,SAASC,iBAAT,CAA2BV,KAA3B,EAAkC;AAAA,KACnBW,QADmB,GACqDX,KADrD,CACzBY,IADyB;AAAA,KACTC,QADS,GACqDb,KADrD,CACTa,QADS;AAAA,KACCC,MADD,GACqDd,KADrD,CACCc,MADD;AAAA,KACSC,KADT,GACqDf,KADrD,CACSe,KADT;AAAA,KACgBC,oBADhB,GACqDhB,KADrD,CACgBgB,oBADhB;AAAA,KACsCP,UADtC,GACqDT,KADrD,CACsCS,UADtC;AAAA,KAEzBQ,SAFyB,GAEgCjB,KAFhC,CAEzBiB,SAFyB;AAAA,KAEdC,gBAFc,GAEgClB,KAFhC,CAEdkB,gBAFc;AAAA,KAEIC,uBAFJ,GAEgCnB,KAFhC,CAEImB,uBAFJ;;;AAIjC,KAAMC,eAAe,sBAAUP,QAAV,IAAsBA,QAAtB,GAAiCI,cAAcI,eAApE;;AAJiC,kBAMV,yBAAU;AAChCP,gBADgC;AAEhCM,4BAFgC;AAGhCL,cAHgC;AAIhCC,4CAJgC;AAKhCG,kDALgC;AAMhCV;AANgC,EAAV,CANU;AAAA,KAMzBa,UANyB,cAMzBA,UANyB;;AAejC,QAAO;AACNL,sBADM;AAENC,oBAAkBA,oBAAoBD,SAFhC;AAGNH,UAAQA,OAAOS,IAAP,EAHF;AAINZ,oBAJM;AAKNW;AALM,EAAP;AAOA;AACD,SAASE,UAAT,CAAoBxB,KAApB,EAAqD;AAAA,KAA1ByB,gBAA0B,uEAAP,KAAO;;AACpD,KAAIC,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;AAC1C,MAAI,CAACH,gBAAL,EAAuBpC,IAAI,aAAJ;AACvB;;AAED,KAAMwC,QAAQC,eAAe9B,KAAf,CAAd;AALoD,KAM5CiB,SAN4C,GAMFY,KANE,CAM5CZ,SAN4C;AAAA,KAMjCC,gBANiC,GAMFW,KANE,CAMjCX,gBANiC;AAAA,KAMfP,QANe,GAMFkB,KANE,CAMflB,QANe;AAAA,KAOlCoB,eAPkC,GAONF,KAPM,CAO5CG,QAP4C;AAAA,KAOjBlB,MAPiB,GAONe,KAPM,CAOjBf,MAPiB;AAAA,KAQ5CmB,cAR4C,GAQfjC,KARe,CAQ5CiC,cAR4C;AAAA,KAQ5BC,QAR4B,GAQflC,KARe,CAQ5BkC,QAR4B;;;AAUpD,KAAMF,WAAWC,eAAeF,eAAf,CAAjB;;AAEA,KAAMI,aAAapC,cAAcC,KAAd,CAAnB;AACA,KAAMoC,cAAc,qDACnB,sCAAkBD,UAAlB,EAA8BD,QAA9B,CADmB,EAEnB,EAAEF,kBAAF,EAAYf,oBAAZ,EAAuBC,kCAAvB,EAAyCP,kBAAzC,EAFmB,EAGnBG,OAAOuB,MAAP,EAHmB,CAApB;;AAMA,qBACIR,KADJ;AAECf,gBAFD;AAGCkB,oBAHD;AAICI;AAJD;AAMA;;AAED,SAASE,WAAT,CAAqBC,QAArB,EAA+BC,aAA/B,EAA8CxC,KAA9C,EAAqDyC,kBAArD,EAAyEC,kBAAzE,EAA6F;AAAA,KACpF/B,QADoF,GACtB4B,QADsB,CACpF5B,QADoF;AAAA,KAC1EG,MAD0E,GACtByB,QADsB,CAC1EzB,MAD0E;AAAA,KAClEG,SADkE,GACtBsB,QADsB,CAClEtB,SADkE;AAAA,KACvDC,gBADuD,GACtBqB,QADsB,CACvDrB,gBADuD;AAAA,KACrCI,UADqC,GACtBiB,QADsB,CACrCjB,UADqC;;;AAG5F,KAAMqB,WAAW,iBAAKhC,QAAL,CAAjB;;AAH4F,6BAIvE6B,cAAcH,MAAd,EAJuE;AAAA;AAAA,KAIrFO,KAJqF;AAAA,KAI9EC,GAJ8E;;AAM5F,KAAInB,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;AAC1CvC,MAAI,gBAAJ;AACA;;AAR2F,KAUpF4C,cAVoF,GAUlCjC,KAVkC,CAUpFiC,cAVoF;AAAA,KAUpEC,QAVoE,GAUlClC,KAVkC,CAUpEkC,QAVoE;AAAA,KAU1DY,OAV0D,GAUlC9C,KAVkC,CAU1D8C,OAV0D;AAAA,KAUjDrC,UAViD,GAUlCT,KAVkC,CAUjDS,UAViD;AAAA,KAWpFsC,8BAXoF,GAWjD/C,KAXiD,CAWpF+C,8BAXoF;;AAY5F,KAAMC,YAAYxC,mBAAmBC,UAAnB,CAAlB;AACA,KAAM0B,aAAapC,cAAcC,KAAd,CAAnB;;AAEA,KAAMiD,gBAAgBC,UAAUpC,MAAV,EAAkBqB,UAAlB,EAA8BW,OAA9B,EAAuCE,SAAvC,CAAtB;;AAEA;AACA,KAAIjB,wBAAJ;AACA,KAAI,CAACU,kBAAD,IAAuBI,OAAO5B,UAAU0B,QAAV,CAAlC,EAAuD;AACtD;AADsD,6BAGvBH,cAAcW,KAAd,EAHuB;AAAA;AAAA,MAG/CC,UAH+C;AAAA,MAGnCC,QAHmC;;AAAA,6BAIjBJ,cAAcE,KAAd,EAJiB;AAAA;AAAA,MAI/CG,aAJ+C;AAAA,MAIhCC,WAJgC;;AAKtD,MAAMC,kBACL,CAACD,cAAcD,aAAf,KAAiCD,WAAWD,UAA5C,KAA2DP,MAAMD,KAAjE,CADD;AAEA,MAAMa,WAAWV,iCAAiCF,MAAMW,eAAvC,GAAyDZ,KAA1E;;AAEA,MAAMc,YAAYlB,cAAcvB,UAAU0B,QAAV,CAAd,CAAlB;AACA;AACA,MAAMgB,WAAWrC,WAAWX,QAAX,EAAqB,CAAC8C,QAAD,EAAWZ,GAAX,CAArB,EAAsC5B,SAAtC,EAAiDgC,aAAjD,EAAgE;AAChFW,kBAAehB,KADiE;AAEhFiB,gBAAa,EAAElB,kBAAF,EAAYe,oBAAZ;AAFmE,GAAhE,CAAjB;AAIA3B,oBAAkB4B,SAAS3B,QAA3B;AACAiB,gBAAcZ,MAAd,CAAqBsB,SAAStB,MAA9B;AACA;AACA,EAlBD,MAkBO,IAAII,sBAAsBI,MAAM5B,UAAU0B,QAAV,CAAhC,EAAqD;AAC3D;AACA;;AAEA;AACA,MAAMmB,KAAKtB,cAAcvB,UAAU0B,QAAV,CAAd,IAAqCH,cAAcW,KAAd,GAAsB,CAAtB,CAAhD;;AAL2D,8BAMhCX,cACzBW,KADyB,GAEzBY,GAFyB,CAErB;AAAA,UAAKC,IAAIF,EAAT;AAAA,GAFqB,EAGzBC,GAHyB,CAGrBvB,cAAcyB,MAHO,CANgC;AAAA;AAAA,MAMpDR,SANoD;AAAA,MAM1CS,MAN0C;;AAW3D,MAAMP,YAAWrC,WAAWX,QAAX,EAAqB,CAAC8C,SAAD,EAAWS,MAAX,CAArB,EAAyCjD,SAAzC,EAAoDgC,aAApD,CAAjB;AACAlB,oBAAkB4B,UAAS3B,QAA3B;AACAiB,gBAAcZ,MAAd,CAAqBsB,UAAStB,MAA9B,EAb2D,CAapB;AACvC;AACD;AACA,KAAML,WAAWC,eAAeF,eAAf,CAAjB;AACA,KAAMK,cAAc,qDACnB,sCAAkBD,UAAlB,EAA8BD,QAA9B,EAAwCQ,kBAAxC,CADmB,EAEnB,EAAEV,kBAAF,EAAYf,oBAAZ,EAAuBC,kCAAvB,EAAyCP,kBAAzC,EAFmB,EAGnBsC,cAAcZ,MAAd,EAHmB,CAApB;;AAMA,QAAO;AACNvB,UAAQmC,aADF;AAENhC,sBAFM;AAGNmB,0BAHM;AAINJ,oBAJM;AAKNrB,oBALM;AAMNW;AANM,EAAP;AAQA;;AAED,SAASQ,cAAT,CAAwB9B,KAAxB,EAA+B;AAAA,KACXmE,aADW,GAC0DnE,KAD1D,CACtBiB,SADsB;AAAA,KACcmD,YADd,GAC0DpE,KAD1D,CACIqE,QADJ;AAAA,KAC4BzD,IAD5B,GAC0DZ,KAD1D,CAC4BY,IAD5B;AAAA,KACkCkC,OADlC,GAC0D9C,KAD1D,CACkC8C,OADlC;AAAA,KAC2CrC,UAD3C,GAC0DT,KAD1D,CAC2CS,UAD3C;;;AAG9B,KAAIiB,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,IAAyC,sBAAU5B,MAAMc,MAAN,CAAamD,MAAvB,CAA7C,EAA6E;AAC5E,OAAK,IAAIK,IAAI,CAAb,EAAgBA,IAAI1D,KAAK2D,MAAzB,EAAiCD,GAAjC,EAAsC;AACrC,OAAME,OAAO5D,KAAK0D,IAAI,CAAT,CAAb;AACA,OAAMG,OAAO7D,KAAK0D,CAAL,CAAb;AACA,OAAIH,cAAcK,IAAd,IAAsBL,cAAcM,IAAd,CAA1B,EAA+C;AAC9C,UAAM,IAAIC,KAAJ,CACL,2FADK,CAAN;AAGA;AACD;AACD;;AAED,KAAM1B,YAAYxC,mBAAmBC,UAAnB,CAAlB;AACA,KAAM0B,aAAapC,cAAcC,KAAd,CAAnB;;AAEA,KAAM2E,SACL,OAAOP,YAAP,KAAwB,UAAxB,GACGA,aAAaxD,IAAb,CADH,GAEG,qBAASwD,aAAaL,GAAb,CAAiB;AAAA,SAAK,oBAAQa,CAAR,CAAL;AAAA,EAAjB,EAAkCb,GAAlC,CAAsC;AAAA,SAAQc,KAAKjE,IAAL,EAAWuD,aAAX,CAAR;AAAA,EAAtC,CAAT,CAHJ;;AAlB8B,0BAuBwCzD,kBAAkBV,KAAlB,CAvBxC;AAAA,KAuBtBiB,SAvBsB,sBAuBtBA,SAvBsB;AAAA,KAuBXC,gBAvBW,sBAuBXA,gBAvBW;AAAA,KAuBOJ,MAvBP,sBAuBOA,MAvBP;AAAA,KAuBeH,QAvBf,sBAuBeA,QAvBf;AAAA,KAuByBW,UAvBzB,sBAuByBA,UAvBzB;;AAwB9B,KAAM2B,gBAAgBC,UAAUpC,MAAV,EAAkBqB,UAAlB,EAA8BW,OAA9B,EAAuCE,SAAvC,CAAtB;;AAxB8B,mBA0BD1B,WAAWX,QAAX,EAAqBgE,MAArB,EAA6BR,aAA7B,EAA4ClB,aAA5C,CA1BC;AAAA,KA0BtBjB,QA1BsB,eA0BtBA,QA1BsB;AAAA,KA0BZK,MA1BY,eA0BZA,MA1BY;;AA4B9B,KAAIX,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,IAAyCI,SAASuC,MAAT,IAAmB,CAAhE,EAAmE;AAClE,QAAM,IAAIG,KAAJ,cACM1C,SAASuC,MADf,4DAAN;AAGA;AACD,QAAO;AACNvC,oBADM;AAENlB,UAAQmC,cAAcZ,MAAd,CAAqBA,MAArB,CAFF;AAGNpB,sBAHM;AAINC,oCAJM;AAKNP,oBALM;AAMNW;AANM,EAAP;AAQA;;AAED,SAAS4B,SAAT,CAAmBpC,MAAnB,EAA2BqB,UAA3B,EAAuCW,OAAvC,EAA+D;AAAA,KAAfE,SAAe,uEAAH,CAAG;;AAC9D,KAAIlC,OAAOgE,gBAAX,EAA6B;AAC5B,MAAIC,MAAMjC,OAAN,CAAJ,EAAoB,MAAM,IAAI4B,KAAJ,CAAU,8CAAV,CAAN;AACpB5D,SAAOgE,gBAAP,CAAwB,CAAC,CAAD,EAAI3C,WAAW9B,KAAf,CAAxB,EAA+CyC,OAA/C;AACA,EAHD,MAGO,IAAIhC,OAAOgC,OAAX,EAAoB;AAC1B,MAAIiC,MAAMjC,OAAN,CAAJ,EAAoB,MAAM,IAAI4B,KAAJ,CAAU,8CAAV,CAAN;AACpB5D,SAAOqC,KAAP,CAAa,CAAC,CAAD,EAAIhB,WAAW9B,KAAf,CAAb;AACAS,SAAOgC,OAAP,CAAeA,UAAU,CAAzB;AACA,EAJM,MAIA;AAAA,aACkBiC,MAAMjC,OAAN,IAAiBA,OAAjB,GAA2B,EAAExC,MAAMwC,OAAR,EAAiBvC,OAAOuC,OAAxB,EAD7C;AAAA,MACExC,IADF,QACEA,IADF;AAAA,MACQC,KADR,QACQA,KADR;;AAEN,MAAIyC,YAAY,CAAhB,EAAmB;AAClBlC,UAAOqC,KAAP,CAAa,CAAC7C,IAAD,EAAO6B,WAAW9B,KAAX,GAAmBE,KAA1B,CAAb;AACA,GAFD,MAEO;AACNO,UAAOqC,KAAP,CAAa,CAAChB,WAAW9B,KAAX,GAAmBE,KAApB,EAA2BD,IAA3B,CAAb;AACA;AACD;AACD,QAAOQ,MAAP;AACA;;AAED,SAASkE,gBAAT,CAA0BC,KAA1B,EAAiC;AAAA,KACxBC,SADwB,GACCD,KADD,CACxBC,SADwB;AAAA,KACbC,SADa,GACCF,KADD,CACbE,SADa;;;AAGhC,QAAO;AACNC,WAAS,CAACC,KAAKC,GAAL,CAASJ,UAAU,CAAV,CAAT,EAAuBC,UAAU,CAAV,CAAvB,CAAD,EAAuCE,KAAKC,GAAL,CAASJ,UAAU,CAAV,CAAT,EAAuBC,UAAU,CAAV,CAAvB,CAAvC,CADH;AAENI,eAAa,CAACF,KAAKG,GAAL,CAASN,UAAU,CAAV,CAAT,EAAuBC,UAAU,CAAV,CAAvB,CAAD,EAAuCE,KAAKG,GAAL,CAASN,UAAU,CAAV,CAAT,EAAuBC,UAAU,CAAV,CAAvB,CAAvC;AAFP,EAAP;AAIA;;IAEKM,W;;;AACL,wBAAc;AAAA;;AAAA;;AAEb,QAAKC,WAAL,GAAmB,MAAKA,WAAL,CAAiBC,IAAjB,OAAnB;AACA,QAAKC,iBAAL,GAAyB,MAAKA,iBAAL,CAAuBD,IAAvB,OAAzB;;AAEA,QAAKE,eAAL,GAAuB,MAAKA,eAAL,CAAqBF,IAArB,OAAvB;AACA,QAAKG,gBAAL,GAAwB,MAAKA,gBAAL,CAAsBH,IAAtB,OAAxB;AACA,QAAKI,gBAAL,GAAwB,MAAKA,gBAAL,CAAsBJ,IAAtB,OAAxB;AACA,QAAKK,UAAL,GAAkB,MAAKA,UAAL,CAAgBL,IAAhB,OAAlB;AACA,QAAKM,eAAL,GAAuB,MAAKA,eAAL,CAAqBN,IAArB,OAAvB;AACA,QAAKO,kBAAL,GAA0B,MAAKA,kBAAL,CAAwBP,IAAxB,OAA1B;AACA,QAAKQ,SAAL,GAAiB,MAAKA,SAAL,CAAeR,IAAf,OAAjB;AACA,QAAKS,YAAL,GAAoB,MAAKA,YAAL,CAAkBT,IAAlB,OAApB;AACA,QAAKU,WAAL,GAAmB,MAAKA,WAAL,CAAiBV,IAAjB,OAAnB;AACA,QAAKW,eAAL,GAAuB,MAAKA,eAAL,CAAqBX,IAArB,OAAvB;AACA,QAAKY,iBAAL,GAAyB,MAAKA,iBAAL,CAAuBZ,IAAvB,OAAzB;AACA,QAAKa,iBAAL,GAAyB,MAAKA,iBAAL,CAAuBb,IAAvB,OAAzB;AACA,QAAKc,eAAL,GAAuB,MAAKA,eAAL,CAAqBd,IAArB,OAAvB;AACA,QAAKe,UAAL,GAAkB,MAAKA,UAAL,CAAgBf,IAAhB,OAAlB;AACA,QAAKgB,aAAL,GAAqB,MAAKA,aAAL,CAAmBhB,IAAnB,OAArB;;AAEA,QAAKiB,SAAL,GAAiB,MAAKA,SAAL,CAAejB,IAAf,OAAjB;AACA,QAAKkB,eAAL,GAAuB,MAAKA,eAAL,CAAqBlB,IAArB,OAAvB;AACA,QAAKmB,SAAL,GAAiB,MAAKA,SAAL,CAAenB,IAAf,OAAjB;AACA,QAAKoB,SAAL,GAAiB,MAAKA,SAAL,CAAepB,IAAf,OAAjB;AACA,QAAKqB,YAAL,GAAoB,MAAKA,YAAL,CAAkBrB,IAAlB,OAApB;AACA,QAAKsB,uBAAL,GAA+B,MAAKA,uBAAL,CAA6BtB,IAA7B,OAA/B;AACA,QAAKuB,sBAAL,GAA8B,MAAKA,sBAAL,CAA4BvB,IAA5B,OAA9B;AACA,QAAKwB,IAAL,GAAY,MAAKA,IAAL,CAAUxB,IAAV,OAAZ;AACA,QAAKyB,MAAL,GAAc,MAAKA,MAAL,CAAYzB,IAAZ,OAAd;AACA,QAAK0B,mBAAL,GAA2B,MAAKA,mBAAL,CAAyB1B,IAAzB,OAA3B;;AAEA,QAAK2B,aAAL,GAAqB,EAArB;AACA,QAAKC,SAAL,GAAiB,MAAKA,SAAL,CAAe5B,IAAf,OAAjB;AACA,QAAK6B,WAAL,GAAmB,MAAKA,WAAL,CAAiB7B,IAAjB,OAAnB;AACA,QAAK8B,QAAL,GAAgB,MAAKA,QAAL,CAAc9B,IAAd,OAAhB;AACA,QAAK+B,oBAAL,GAA4B,MAAKA,oBAAL,CAA0B/B,IAA1B,OAA5B;AACA,QAAKgC,uBAAL,GAA+B,MAAKA,uBAAL,CAA6BhC,IAA7B,OAA/B;AACA,QAAKiC,cAAL,GAAsB,MAAKA,cAAL,CAAoBjC,IAApB,OAAtB;AACA,QAAKkC,eAAL,GAAuB,MAAKA,eAAL,CAAqBlC,IAArB,OAAvB;AACA;AACA,QAAKmC,gBAAL,GAAwB,EAAxB;AACA,QAAKC,aAAL,GAAqB,KAArB;;AAEA,QAAKlG,KAAL,GAAa,EAAb;AACA,QAAKmG,YAAL,GAAoB,EAApB;AACA,QAAKC,kBAAL,GAA0B,CAA1B;AA9Ca;AA+Cb;;;;uCACoBC,I,EAAM;AAC1B,QAAKC,gBAAL,GAAwBD,IAAxB;AACA;;;0CACuBA,I,EAAM;AAC7B,QAAKE,mBAAL,GAA2BF,IAA3B;AACA;;;oCACiB;AACjB,UAAO,KAAKF,YAAZ;AACA;;;gCACa;AACb,uBACI,KAAKnG,KADT;AAEClB,cAAU,KAAKA;AAFhB;AAIA;;;sCACmB;AACnB,OAAI,KAAKyH,mBAAT,EAA8B;AAC7B,WAAO,KAAKA,mBAAL,CAAyBxC,iBAAzB,EAAP;AACA;AACD;;;2CACwB;AACxB,QAAKqC,kBAAL;AACA,UAAO,KAAKA,kBAAZ;AACA;;;oCACiB;AACjB,OAAMI,WAAW,KAAKzC,iBAAL,EAAjB;AACA,OAAIyC,YAAYA,SAASC,IAAzB,EAA+B;AAC9B,4BACC,CACCD,SAASC,IADV;AAEC;AACAD,aAASE,UAHV,CADD,EAMC,KAAKvI,KAAL,CAAWwI,KANZ;AAQA;AACD;;;qCACkB;AAClB,OAAMH,WAAW,KAAKzC,iBAAL,EAAjB;AACA,OAAIyC,YAAYA,SAASE,UAAzB,EAAqC;AACpC,4BACC,CACCF,SAASE,UADV,CADD,EAKC,KAAKvI,KAAL,CAAWwI,KALZ;AAOA;AACD;;;qCACkB;AAClB,OAAMH,WAAW,KAAKzC,iBAAL,EAAjB;AACA,OAAIyC,YAAYA,SAASC,IAAzB,EAA+B;AAC9B,4BACC,CACCD,SAASC,IADV;AAEC;AACAD,aAASE,UAHV,EAICF,SAASI,EAJV,CADD,EAOC,KAAKzI,KAAL,CAAWwI,KAPZ;AASA;AACD;;;4BACSE,E,EAAIC,I,EAAM;AAAA,+BAMfA,IANe,CAElBC,gBAFkB;AAAA,OAElBA,gBAFkB,yCAEC,oBAAQ;AAC1BC,eAAW,KADe;AAE1BC,gBAAY;AAFc,IAAR,CAFD;;AAOnB,QAAKxB,aAAL,GAAqB,KAAKA,aAAL,CAAmByB,MAAnB;AACpBL;AADoB,MAEjBC,IAFiB;AAGpBC;AAHoB,MAArB;AAKA;;;8BACWF,E,EAAI;AACf,QAAKpB,aAAL,GAAqB,KAAKA,aAAL,CAAmB0B,MAAnB,CAA0B;AAAA,WAAQnE,KAAK6D,EAAL,KAAYA,EAApB;AAAA,IAA1B,CAArB;AACA;;;wCACqB;AACrB,UAAO,KAAKpB,aAAL,CAAmBvD,GAAnB,CAAuB;AAAA,WAAQc,KAAK+D,gBAAL,EAAR;AAAA,IAAvB,CAAP;AACA;;;iCACcK,S,EAAW;AACzB,QAAKd,gBAAL,CAAsBP,cAAtB,CAAqCqB,SAArC;AACA;;;2BACQP,E,EAAI;AACZ,OAAMQ,qBAAqB,KAAK5B,aAAL,CAAmB0B,MAAnB,CAC1B;AAAA,WAAQnE,KAAK+D,gBAAL,GAAwBC,SAAhC;AAAA,IAD0B,CAA3B;;AAIA,UAAOK,mBAAmB3E,MAAnB,GAA4B,CAA5B,IAAiC,iBAAK2E,kBAAL,EAAyBR,EAAzB,KAAgCA,EAAxE;AACA;;;oCACiBS,O,EAASC,C,EAAG;AAAA,gBACwB,KAAKvH,KAD7B;AAAA,OACrBZ,SADqB,UACrBA,SADqB;AAAA,OACVmB,WADU,UACVA,WADU;AAAA,OACGJ,QADH,UACGA,QADH;AAAA,OACalB,MADb,UACaA,MADb;;;AAG7B,OAAMuI,gBAAgB,qCAAiBjH,WAAjB,EAA8B+G,OAA9B,CAAtB;AACA,OAAMG,cAAc,mCAAexI,MAAf,EAAuBG,SAAvB,EAAkCkI,OAAlC,EAA2CnH,QAA3C,CAApB;;AAEA,QAAKuH,YAAL,CACC,aADD,EAEC;AACCJ,oBADD;AAECG,4BAFD;AAGCD;AAHD,IAFD,EAOCD,CAPD;AASA;;;0CACuBI,S,EAAW;AAAA,iBAO9B,KAAK3H,KAPyB;AAAA,OAEjCZ,SAFiC,WAEjCA,SAFiC;AAAA,OAGjCC,gBAHiC,WAGjCA,gBAHiC;AAAA,OAIzBsB,aAJyB,WAIjC1B,MAJiC;AAAA,OAKpB4B,kBALoB,WAKjCN,WALiC;AAAA,OAMvBL,eANuB,WAMjCC,QANiC;AAAA,OAQ1BV,UAR0B,GAQX,KAAKO,KARM,CAQ1BP,UAR0B;AAAA,OAS1BX,QAT0B,GASb,IATa,CAS1BA,QAT0B;AAAA,OAU1BsB,cAV0B,GAUP,KAAKjC,KAVE,CAU1BiC,cAV0B;;AAAA,sBAYWX,WAC5CX,QAD4C,EAE5C6I,SAF4C,EAG5CvI,SAH4C,EAI5CuB,aAJ4C,EAK5C;AACCiH,qBAAiB1H,eADlB;AAEC2H,mBAAelH,cAAcH,MAAd;AAFhB,IAL4C,CAZX;AAAA,OAYhBsH,cAZgB,gBAY1B3H,QAZ0B;AAAA,OAYAK,MAZA,gBAYAA,MAZA;;AAuBlC,OAAML,WAAWC,eAAe0H,cAAf,CAAjB;AACA,OAAMC,eAAepH,cAAcjB,IAAd,GAAqBc,MAArB,CAA4BA,MAA5B,CAArB;AACA,OAAMD,cAAc,qDACnBM,kBADmB,EAEnB,EAAEV,kBAAF,EAAYf,oBAAZ,EAAuBC,kCAAvB,EAAyCP,kBAAzC,EAFmB,EAGnBiJ,aAAavH,MAAb,EAHmB,CAApB;;AAMA,UAAO;AACNvB,YAAQ8I,YADF;AAEN5H,sBAFM;AAGNI;AAHM,IAAP;AAKA;;;kCACeyH,Y,EAAcC,U,EAAY;AAAA,OACzBC,kBADyB,GACFF,YADE,CACjC/I,MADiC;AAAA,iBASrC,KAAKe,KATgC;AAAA,OAIhCW,aAJgC,WAIxC1B,MAJwC;AAAA,OAK3B4B,kBAL2B,WAKxCN,WALwC;AAAA,OAM9BL,eAN8B,WAMxCC,QANwC;AAAA,OAOxCf,SAPwC,WAOxCA,SAPwC;AAAA,OAQxCC,gBARwC,WAQxCA,gBARwC;AAAA,OAUjCI,UAViC,GAUlB,KAAKO,KAVa,CAUjCP,UAViC;AAAA,OAWjCX,QAXiC,GAWpB,IAXoB,CAWjCA,QAXiC;AAAA,OAYjCsB,cAZiC,GAYd,KAAKjC,KAZS,CAYjCiC,cAZiC;;AAAA,2BAcE+C,iBAAiB6E,YAAjB,CAdF;AAAA,OAcxBG,GAdwB,qBAcjC5E,OAdiC;AAAA,OAcN6E,GAdM,qBAcnB1E,WAdmB;;AAAA,4BAeEP,iBAAiB8E,UAAjB,CAfF;AAAA,OAexBI,GAfwB,sBAejC9E,OAfiC;AAAA,OAeN+E,GAfM,sBAenB5E,WAfmB;;AAiBzC,OAAM6D,IAAIW,mBAAmB5G,KAAnB,GAA2B,CAA3B,CAAV;;AAEA,OAAMiH,QAAQ/E,KAAKgF,KAAL,CAAW,EAAEJ,IAAI,CAAJ,IAASC,IAAI,CAAJ,CAAT,GAAkBF,IAAI,CAAJ,IAASG,IAAI,CAAJ,CAA7B,KAAwCH,IAAI,CAAJ,IAASC,IAAI,CAAJ,CAAjD,CAAX,CAAd;AACA,OAAMK,QAAQjF,KAAKgF,KAAL,CACbjB,IACC,CAAC,CAACA,IAAIa,IAAI,CAAJ,CAAL,KAAgBb,IAAIc,IAAI,CAAJ,CAApB,IAA8B,CAACd,IAAIY,IAAI,CAAJ,CAAL,KAAgBZ,IAAIe,IAAI,CAAJ,CAApB,CAA/B,KACEf,IAAIY,IAAI,CAAJ,CAAJ,IAAcZ,IAAIa,IAAI,CAAJ,CAAlB,CADF,CAFY,CAAd;;AAMA,OAAMjG,IAAIqB,KAAKgF,KAAL,CAAW,CAACD,KAAD,GAASJ,IAAI,CAAJ,CAAT,IAAmB,CAACI,KAAD,GAASF,IAAI,CAAJ,CAA5B,CAAX,CAAV;AACA,OAAMK,IAAIlF,KAAKgF,KAAL,CAAWjB,IAAI,CAACkB,QAAQlB,CAAT,KAAeA,IAAIY,IAAI,CAAJ,CAAnB,KAA8BM,SAASlB,IAAIc,IAAI,CAAJ,CAAb,CAA9B,CAAf,CAAV;;AAEA,OAAMV,YAAY,CAACxF,CAAD,EAAIuG,CAAJ,EAAOxG,GAAP,CAAWgG,mBAAmB9F,MAA9B,CAAlB;AACA;;AA9ByC,sBAgCI3C,WAC5CX,QAD4C,EAE5C6I,SAF4C,EAG5CvI,SAH4C,EAI5C8I,kBAJ4C,EAK5C;AACCN,qBAAiB1H,eADlB;AAEC2H,mBAAelH,cAAcH,MAAd;AAFhB,IAL4C,CAhCJ;AAAA,OAgCvBsH,cAhCuB,gBAgCjC3H,QAhCiC;AAAA,OAgCPK,MAhCO,gBAgCPA,MAhCO;;AA2CzC,OAAML,WAAWC,eAAe0H,cAAf,CAAjB;AACA,OAAMC,eAAepH,cAAcjB,IAAd,GAAqBc,MAArB,CAA4BA,MAA5B,CAArB;;AAEA,OAAM8G,UAAUW,WAAW5E,SAA3B;AACA,OAAM9C,cAAc,qDACnBM,kBADmB,EAEnB,EAAEV,kBAAF,EAAYf,oBAAZ,EAAuBC,kCAAvB,EAAyCP,kBAAzC,EAFmB,EAGnBiJ,aAAavH,MAAb,EAHmB,CAApB;AAKA,OAAMiH,cAAc,mCAAeM,YAAf,EAA6B3I,SAA7B,EAAwCkI,OAAxC,EAAiDnH,QAAjD,CAApB;;AAEA,UAAO;AACNI,4BADM;AAENtB,YAAQ8I,YAFF;AAGN5H,sBAHM;AAINmH,oBAJM;AAKNG;AALM,IAAP;AAOA;;;+BACY;AACZ,QAAKnB,gBAAL,CAAsBqC,UAAtB;AACA,QAAKjB,YAAL,CAAkB,YAAlB;AACA;;;kCACeM,Y,EAAcC,U,EAAYV,C,EAAG;AAAA;;AAC5C,OAAI,CAAC,KAAKqB,iCAAV,EAA6C;AAC5C,SAAKA,iCAAL,GAAyC,IAAzC;AACA,QAAM5I,QAAQ,KAAKgF,eAAL,CAAqBgD,YAArB,EAAmCC,UAAnC,CAAd;;AAEA,SAAKP,YAAL,CAAkB,WAAlB,EAA+B1H,KAA/B,EAAsCuH,CAAtC;;AAEA,SAAKU,UAAL,GAAkBA,UAAlB;;AAEAY,0BAAsB,YAAM;AAC3B,YAAKC,eAAL;AACA,YAAKxD,IAAL,CAAU,EAAEyD,SAAS,WAAX,EAAV;AACA,YAAKH,iCAAL,GAAyC,KAAzC;AACA,KAJD;AAKA;AACD;;;qCACkBZ,Y,EAAcT,C,EAAG;AAAA,OAC3BnI,SAD2B,GACb,KAAKY,KADQ,CAC3BZ,SAD2B;;;AAGnC,OAAI,KAAK6I,UAAT,EAAqB;AACpB,QAAMjI,QAAQ,KAAKgF,eAAL,CAAqBgD,YAArB,EAAmC,KAAKC,UAAxC,CAAd;AADoB,QAEZhJ,MAFY,GAEDe,KAFC,CAEZf,MAFY;;AAGpB,SAAKyI,YAAL,CAAkB,WAAlB,EAA+B1H,KAA/B,EAAsCuH,CAAtC;;AAEA,SAAKU,UAAL,GAAkB,IAAlB;;AAEA,SAAKe,gBAAL;;AAPoB,QASZlK,QATY,GASC,IATD,CASZA,QATY;;AAUpB,QAAMmK,YAAY,iBAAKnK,QAAL,CAAlB;;AAEA,QAAMiC,QAAQ,iBAAK9B,OAAOuB,MAAP,EAAL,CAAd;AACA,QAAMQ,MAAM5B,UAAU6J,SAAV,CAAZ;AAboB,QAcZC,UAdY,GAcG,KAAK/K,KAdR,CAcZ+K,UAdY;;;AAgBpB,SAAKC,QAAL,CAAcnJ,KAAd,EAAqB,YAAM;AAC1B,SAAIe,QAAQC,GAAZ,EAAiB;AAChBkI,iBAAWnI,KAAX,EAAkBC,GAAlB;AACA;AACD,KAJD;AAKA;AACD;;;6BACUoI,a,EAAe9B,O,EAASC,C,EAAG;AACrC,OAAI,KAAKrB,aAAT,EAAwB;AACxB;AAFqC,iBAGmC,KAAKlG,KAHxC;AAAA,OAG7BZ,SAH6B,WAG7BA,SAH6B;AAAA,OAGVuB,aAHU,WAGlB1B,MAHkB;AAAA,OAGeiB,eAHf,WAGKC,QAHL;AAAA,gBAIE,KAAKhC,KAJP;AAAA,OAI7BkL,cAJ6B,UAI7BA,cAJ6B;AAAA,OAIbC,UAJa,UAIbA,UAJa;AAAA,OAK7BxK,QAL6B,GAKhB,IALgB,CAK7BA,QAL6B;;AAMrC,OAAMyK,OAAOD,WAAW;AACvBrK,YAAQ0B,aADe;AAEvBvB,wBAFuB;AAGvBkI,oBAHuB;AAIvBnH,cAAUD,eAJa;AAKvBpB;AALuB,IAAX,CAAb;;AAQA,OAAM0K,KAAK7I,cAAc4I,IAAd,CAAX;AACA,OAAME,IAAIL,gBAAgB,CAAhB,GAAoB,IAAIC,cAAxB,GAAyC,IAAIA,cAAvD;AACA,OAAM1B,YAAYhH,cAChBW,KADgB,GAEhBY,GAFgB,CAEZ;AAAA,WAAKsH,KAAK,CAACrH,IAAIqH,EAAL,IAAWC,CAArB;AAAA,IAFY,EAGhBvH,GAHgB,CAGZvB,cAAcyB,MAHF,CAAlB;;AAhBqC,+BAqBK,KAAKgD,uBAAL,CAA6BuC,SAA7B,CArBL;AAAA,OAqB7B1I,MArB6B,yBAqB7BA,MArB6B;AAAA,OAqBrBkB,QArBqB,yBAqBrBA,QArBqB;AAAA,OAqBXI,WArBW,yBAqBXA,WArBW;;AAuBrC,OAAMkH,cAAc,mCAAexI,MAAf,EAAuBG,SAAvB,EAAkCkI,OAAlC,EAA2CnH,QAA3C,CAApB;AACA,OAAMqH,gBAAgB,qCAAiBjH,WAAjB,EAA8B+G,OAA9B,CAAtB;;AAEA,QAAK0B,gBAAL;;AAEA,OAAMC,YAAY,iBAAKnK,QAAL,CAAlB;;AAEA,OAAMiC,QAAQ,iBAAK9B,OAAOuB,MAAP,EAAL,CAAd;AACA,OAAMQ,MAAM5B,UAAU6J,SAAV,CAAZ;AA/BqC,OAgC7BC,UAhC6B,GAgCd,KAAK/K,KAhCS,CAgC7B+K,UAhC6B;;;AAkCrC,QAAK/C,YAAL,GAAoB;AACnBmB,aAASA,OADU;AAEnBG,iBAAaA,WAFM;AAGnBD,mBAAeA;AAHI,IAApB;;AAMA,QAAKE,YAAL,CACC,MADD,EAEC;AACCzI,kBADD;AAECkB,sBAFD;AAGCI,4BAHD;AAIC+G,oBAJD;AAKCE,gCALD;AAMCC,4BAND;AAOCiC,UAAM;AAPP,IAFD,EAWCnC,CAXD;;AAcA,QAAK4B,QAAL,CACC;AACClK,kBADD;AAECkB,sBAFD;AAGCI;AAHD,IADD,EAMC,YAAM;AACL,QAAIQ,QAAQC,GAAZ,EAAiB;AAChBkI,gBAAWnI,KAAX,EAAkBC,GAAlB;AACA;AACD,IAVF;AAYA;;;4BACS2G,S,EAAW;AAAA,gCACsB,KAAKvC,uBAAL,CAA6BuC,SAA7B,CADtB;AAAA,OACZ1I,MADY,0BACZA,MADY;AAAA,OACJkB,QADI,0BACJA,QADI;AAAA,OACMI,WADN,0BACMA,WADN;;AAEpB,QAAKyI,gBAAL;;AAFoB,OAIZ5J,SAJY,GAIE,KAAKY,KAJP,CAIZZ,SAJY;AAAA,OAKZN,QALY,GAKC,IALD,CAKZA,QALY;;AAMpB,OAAMmK,YAAY,iBAAKnK,QAAL,CAAlB;AACA,OAAMiC,QAAQ,iBAAK9B,OAAOuB,MAAP,EAAL,CAAd;AACA,OAAMQ,MAAM5B,UAAU6J,SAAV,CAAZ;AARoB,OASZC,UATY,GASG,KAAK/K,KATR,CASZ+K,UATY;;;AAWpB,QAAKC,QAAL,CACC;AACClK,kBADD;AAECkB,sBAFD;AAGCI;AAHD,IADD,EAMC,YAAM;AACL,QAAIQ,QAAQC,GAAZ,EAAiBkI,WAAWnI,KAAX,EAAkBC,GAAlB;AACjB,IARF;AAUA;;;4BACS2I,O,EAAShC,S,EAAW;AAC7B,QAAKqB,gBAAL;AAD6B,OAERnI,kBAFQ,GAEe,KAAKb,KAFpB,CAErBO,WAFqB;;AAG7B,OAAMA,cAAcM,mBAAmBqB,GAAnB,CAAuB,gBAAQ;AAClD,QAAIc,KAAK6D,EAAL,KAAY8C,OAAhB,EAAyB;AAAA,SAChBC,MADgB,GACL5G,IADK,CAChB4G,MADgB;;AAExB,yBACI5G,IADJ;AAEC4G,cAAQA,OAAOlK,IAAP,GAAcc,MAAd,CAAqBmH,SAArB,CAFT;AAGCkC,mBAAa;AAHd;AAKA,KAPD,MAOO;AACN,YAAO7G,IAAP;AACA;AACD,IAXmB,CAApB;;AAaA,QAAKmG,QAAL,CAAc;AACb5I;AADa,IAAd;AAGA;;;+BACYuJ,I,EAAM3L,K,EAAOoJ,C,EAAG;AAAA;;AAC5B;;AAEA,QAAK9B,aAAL,CAAmBsE,OAAnB,CAA2B,gBAAQ;AAClC,QAAM/J,qBACF,OAAKA,KADH;AAELlB,eAAU,OAAKA,QAFV;AAGL2G,oBAAe,OAAKA;AAHf,MAAN;AAKAzC,SAAKgH,QAAL,CAAcF,IAAd,EAAoB3L,KAApB,EAA2B6B,KAA3B,EAAkCuH,CAAlC;AACA,IAPD;AAQA;;;uBACIpJ,K,EAAO;AACX,QAAKsH,aAAL,CAAmBsE,OAAnB,CAA2B,gBAAQ;AAClC,QAAI,sBAAU/G,KAAKsC,IAAf,CAAJ,EAA0BtC,KAAKsC,IAAL,CAAUnH,KAAV;AAC1B,IAFD;AAGA;;;2BACQ;AACR,QAAK6K,gBAAL;AACA,QAAK1D,IAAL,CAAU,EAAE2E,OAAO,IAAT,EAAV;AACA;;;4BACS3C,O,EAAS3G,a,SAA2BuJ,W,EAAa;AAAA,OAAvBjI,EAAuB,SAAvBA,EAAuB;AAAA,OAAnBkI,EAAmB,SAAnBA,EAAmB;AAAA,iBACe,KAAKnK,KADpB;AAAA,OAClDZ,SADkD,WAClDA,SADkD;AAAA,OACvCC,gBADuC,WACvCA,gBADuC;AAAA,OACRwB,kBADQ,WACrBN,WADqB;AAAA,OAElDd,UAFkD,GAEnC,KAAKO,KAF8B,CAElDP,UAFkD;AAAA,OAGlDX,QAHkD,GAGrC,IAHqC,CAGlDA,QAHkD;AAAA,OAIlDsB,cAJkD,GAI/B,KAAKjC,KAJ0B,CAIlDiC,cAJkD;;AAM1D;;AACA,OAAI,yBAAaO,cAAcyB,MAA3B,CAAJ,EACC,MAAM,IAAIS,KAAJ,CACL,sDACC,8EAFI,CAAN;;AAKD,OAAM8E,YAAYhH,cAChBW,KADgB,GAEhBY,GAFgB,CAEZ;AAAA,WAAKC,IAAIF,EAAT;AAAA,IAFY,EAGhBC,GAHgB,CAGZvB,cAAcyB,MAHF,CAAlB;;AAb0D,sBAkBb3C,WAC5CX,QAD4C,EAE5C6I,SAF4C,EAG5CvI,SAH4C,EAI5CuB,aAJ4C,EAK5C;AACCiH,qBAAiB,KAAKwC,uCADvB;AAECvC,mBAAe,KAAKwC;AAFrB,IAL4C,CAlBa;AAAA,OAkBxCvC,cAlBwC,gBAkBlD3H,QAlBkD;AAAA,OAkBxBK,MAlBwB,gBAkBxBA,MAlBwB;;AA6B1D,OAAMuH,eAAepH,cAAcjB,IAAd,GAAqBc,MAArB,CAA4BA,MAA5B,CAArB;AACA,OAAML,WAAWC,eAAe0H,cAAf,CAAjB;AACA;;AAEA,OAAML,cAAc,mCAAeM,YAAf,EAA6B3I,SAA7B,EAAwCkI,OAAxC,EAAiDnH,QAAjD,CAApB;AACA,OAAMI,cAAc,qDACnBM,kBADmB,EAEnB,EAAEV,kBAAF,EAAYf,oBAAZ,EAAuBC,kCAAvB,EAAyCP,kBAAzC,EAFmB,EAGnBiJ,aAAavH,MAAb,EAHmB,EAInB2J,EAJmB,EAKnBD,WALmB,CAApB;AAOA,OAAM1C,gBAAgB,qCAAiBjH,WAAjB,EAA8B+G,OAA9B,CAAtB;;AAEA;AACA,UAAO;AACNrI,YAAQ8I,YADF;AAEN5H,sBAFM;AAGNI,4BAHM;AAIN+G,oBAJM;AAKNE,gCALM;AAMNC;AANM,IAAP;AAQA;;;4BACS6C,a,EAAeC,c,EAAgBC,I,EAAMN,W,EAAa3C,C,EAAG;AAAA;;AAC9D,OAAI,CAAC,KAAKkD,2BAAV,EAAuC;AACtC,SAAKA,2BAAL,GAAmC,IAAnC;;AAEA,SAAKL,uCAAL,GACC,KAAKA,uCAAL,IAAgD,KAAKpK,KAAL,CAAWG,QAD5D;AAEA,SAAKkK,qCAAL,GACC,KAAKA,qCAAL,IAA8C,KAAKrK,KAAL,CAAWf,MAAX,CAAkBuB,MAAlB,EAD/C;;AAGA,QAAMR,QAAQ,KAAK+E,SAAL,CAAeuF,aAAf,EAA8BC,cAA9B,EAA8CC,IAA9C,EAAoDN,WAApD,CAAd;;AAEA,SAAKE,uCAAL,GAA+CpK,MAAMG,QAArD;AACA,SAAKkK,qCAAL,GAA6CrK,MAAMf,MAAN,CAAauB,MAAb,EAA7C;;AAEA,SAAK0F,aAAL,GAAqB,IAArB;AACA;;AAEA,SAAKwB,YAAL,CAAkB,KAAlB,EAAyB1H,KAAzB,EAAgCuH,CAAhC;;AAEA,SAAKpB,YAAL,GAAoB;AACnBmB,cAAStH,MAAMsH,OADI;AAEnBG,kBAAazH,MAAMyH,WAFA;AAGnBD,oBAAexH,MAAMwH;AAHF,KAApB;AAKAqB,0BAAsB,YAAM;AAC3B,YAAK4B,2BAAL,GAAmC,KAAnC;AACA,YAAK3B,eAAL;AACA,YAAKxD,IAAL,CAAU,EAAEyD,SAAS,KAAX,EAAV;AACA,KAJD;AAKA;AACD;;;+BACYuB,a,EAAeC,c,EAAgBC,I,EAAMN,W,EAAa3C,C,EAAG;AAAA;;AACjE,OAAMvH,QAAQ,KAAK+E,SAAL,CAAeuF,aAAf,EAA8BC,cAA9B,EAA8CC,IAA9C,EAAoDN,WAApD,CAAd;AACA;AACA,QAAKE,uCAAL,GAA+C,IAA/C;AACA,QAAKC,qCAAL,GAA6C,IAA7C;;AAEA,QAAKnE,aAAL,GAAqB,KAArB;;AAEA;AARiE,OASzDjH,MATyD,GASvBe,KATuB,CASzDf,MATyD;AAAA,OASjDkB,QATiD,GASvBH,KATuB,CASjDG,QATiD;AAAA,OASvCI,WATuC,GASvBP,KATuB,CASvCO,WATuC;;;AAWjE,QAAKmH,YAAL,CAAkB,QAAlB,EAA4B1H,KAA5B,EAAmCuH,CAAnC;;AAEAsB,yBAAsB,YAAM;AAAA,QACnBzJ,SADmB,GACL,OAAKY,KADA,CACnBZ,SADmB;AAAA,QAEnBN,QAFmB,GAEN,MAFM,CAEnBA,QAFmB;;;AAI3B,QAAMmK,YAAY,iBAAKnK,QAAL,CAAlB;AACA,QAAMiC,QAAQ,iBAAK9B,OAAOuB,MAAP,EAAL,CAAd;AACA,QAAMQ,MAAM5B,UAAU6J,SAAV,CAAZ;AACA;;AAP2B,QASnBC,UATmB,GASJ,OAAK/K,KATD,CASnB+K,UATmB;;;AAW3B,WAAKF,gBAAL;;AAEA,WAAKG,QAAL,CACC;AACClK,mBADD;AAECkB,uBAFD;AAGCI;AAHD,KADD,EAMC,YAAM;AACL,SAAIQ,QAAQC,GAAZ,EAAiBkI,WAAWnI,KAAX,EAAkBC,GAAlB;AACjB,KARF;AAUA,IAvBD;AAwBA;;;kCACesJ,a,EAAe9C,a,EAAeD,C,EAAG;AAChD,QAAKG,YAAL,CAAkB,WAAlB,EAA+B,KAAKvB,YAApC,EAAkDoB,CAAlD;AACA;;;mCACgBA,C,EAAG;AACnB,QAAKG,YAAL,CACC,YADD,EAEC;AACCgC,UAAM;AADP,IAFD,EAKCnC,CALD;AAOA;;;kCACeD,O,EAASoD,S,EAAWnD,C,EAAG;AAAA;;AACtC,OAAI,CAAC,KAAKoD,iCAAV,EAA6C;AAC5C,SAAKA,iCAAL,GAAyC,IAAzC;;AAD4C,kBAGS,KAAK3K,KAHd;AAAA,QAGpCO,WAHoC,WAGpCA,WAHoC;AAAA,QAGvBJ,QAHuB,WAGvBA,QAHuB;AAAA,QAGblB,MAHa,WAGbA,MAHa;AAAA,QAGLG,SAHK,WAGLA,SAHK;;AAI5C,QAAMoI,gBAAgB,qCAAiBjH,WAAjB,EAA8B+G,OAA9B,CAAtB;AACA,QAAMG,cAAc,mCAAexI,MAAf,EAAuBG,SAAvB,EAAkCkI,OAAlC,EAA2CnH,QAA3C,CAApB;AACA,SAAKuH,YAAL,CACC,WADD,EAEC;AACCgC,WAAM,IADP;AAECpC,qBAFD;AAGC;AACAsD,kBAAa,KAAKA,WAJnB;AAKCnD,6BALD;AAMCD;AAND,KAFD,EAUCD,CAVD;;AAaA,SAAKqD,WAAL,GAAmBtD,OAAnB;AACA,SAAKnB,YAAL,GAAoB;AACnBmB,qBADmB;AAEnBG,6BAFmB;AAGnBD;AAHmB,KAApB;;AAMAqB,0BAAsB,YAAM;AAC3B,YAAKgC,gBAAL;AACA,YAAKvF,IAAL,CAAU,EAAEyD,SAAS,WAAX,EAAV;AACA,YAAK4B,iCAAL,GAAyC,KAAzC;AACA,KAJD;AAKA;AACD;;;mCACgBpD,C,EAAG;AACnB,QAAKG,YAAL,CAAkB,YAAlB,EAAgC,EAAEgC,MAAM,KAAR,EAAhC,EAAiDnC,CAAjD;AACA,QAAKsD,gBAAL;AACA,QAAKvF,IAAL,CAAU,EAAEyD,SAAS,YAAX,EAAV;AACA;;;yCAC6BxB,C,EAAG;AAAA,OAAfuD,QAAe,SAAfA,QAAe;;AAChC,QAAKpD,YAAL,CAAkB,WAAlB,EAA+B,EAAEoD,kBAAF,EAA/B,EAA6CvD,CAA7C;AACA;;;oCACiCA,C,EAAG;AAAA;;AAAA,OAAxBuD,QAAwB,SAAxBA,QAAwB;AAAA,OAAdxD,OAAc,SAAdA,OAAc;AAAA,iBACiB,KAAKtH,KADtB;AAAA,OAC5BO,WAD4B,WAC5BA,WAD4B;AAAA,OACfJ,QADe,WACfA,QADe;AAAA,OACLlB,MADK,WACLA,MADK;AAAA,OACGG,SADH,WACGA,SADH;;AAEpC,OAAMoI,gBAAgB,qCAAiBjH,WAAjB,EAA8B+G,OAA9B,CAAtB;AACA,OAAMG,cAAc,mCAAexI,MAAf,EAAuBG,SAAvB,EAAkCkI,OAAlC,EAA2CnH,QAA3C,CAApB;;AAEA,QAAKuH,YAAL,CACC,MADD,EAEC;AACCoD,sBADD;AAECxD,oBAFD;AAGCG,4BAHD;AAICD;AAJD,IAFD,EAQCD,CARD;;AAWA,QAAKpB,YAAL,GAAoB;AACnBmB,oBADmB;AAEnBG,4BAFmB;AAGnBD;AAHmB,IAApB;;AAMAqB,yBAAsB,YAAM;AAC3B,WAAKgC,gBAAL;AACA,WAAKvF,IAAL,CAAU,EAAEyD,SAAS,MAAX,EAAV;AACA,IAHD;AAIA;;;uCAC0BxB,C,EAAG;AAAA;;AAAA,OAAdD,OAAc,SAAdA,OAAc;;AAC7B,QAAKI,YAAL,CAAkB,SAAlB,EAA6B,EAAEJ,gBAAF,EAA7B,EAA0CC,CAA1C;;AAEAsB,yBAAsB,YAAM;AAC3B,WAAKgC,gBAAL;AACA,WAAKvF,IAAL,CAAU,EAAEyD,SAAS,SAAX,EAAV;AACA,IAHD;AAIA;;;8BACWuB,a,EAAe/C,C,EAAG;AAAA;;AAC7B,QAAKG,YAAL,CAAkB,OAAlB,EAA2B,KAAKvB,YAAhC,EAA8CoB,CAA9C;;AAEAsB,yBAAsB,YAAM;AAC3B,WAAKgC,gBAAL;AACA,WAAKvF,IAAL,CAAU,EAAEyD,SAAS,OAAX,EAAV;AACA,IAHD;AAIA;;;oCACiBuB,a,EAAe/C,C,EAAG;AACnC,QAAKG,YAAL,CAAkB,UAAlB,EAA8B,EAA9B,EAAkCH,CAAlC;AACA;;;oCACiB;AACjB,OAAMjH,aAAapC,cAAc,KAAKC,KAAnB,CAAnB;AACA,UAAO;AACNW,cAAU,KAAKA,QADT;AAENqB,cAAU,KAAKH,KAAL,CAAWG,QAFf;AAGN3B,WAAO8B,WAAW9B,KAHZ;AAINJ,YAAQkC,WAAWlC,MAJb;AAKNmC,iBAAa,KAAKP,KAAL,CAAWO,WALlB;AAMNtB,YAAQ,KAAKe,KAAL,CAAWf,MANb;AAONG,eAAW,KAAKY,KAAL,CAAWZ,SAPhB;AAQNC,sBAAkB,KAAKW,KAAL,CAAWX,gBARvB;AASN0L,qBAAiB,KAAK5M,KAAL,CAAW2L,IATtB;AAUNzL,YAAQ,KAAKF,KAAL,CAAWE,MAVb;AAWNsI,WAAO,KAAKxI,KAAL,CAAWwI,KAXZ;AAYN1B,eAAW,KAAKA,SAZV;AAaNC,eAAW,KAAKA,SAbV;AAcNnB,uBAAmB,KAAKA,iBAdlB;AAeNwB,YAAQ,KAAKA,MAfP;AAgBNG,eAAW,KAAKA,SAhBV;AAiBNC,iBAAa,KAAKA,WAjBZ;AAkBNN,4BAAwB,KAAKA,sBAlBvB;AAmBNW,qBAAiB,KAAKA,eAnBhB;AAoBNJ,cAAU,KAAKA,QApBT;AAqBNG,oBAAgB,KAAKA;AArBf,IAAP;AAuBA;;;uCACoB;AAAA,qBACWpG,WAAW,KAAKxB,KAAhB,EAAuB,IAAvB,CADX;AAAA,OACZW,QADY,eACZA,QADY;AAAA,OACCkB,KADD;;AAEpB,QAAKmJ,QAAL,CAAcnJ,KAAd;AACA,QAAKlB,QAAL,GAAgBA,QAAhB;AACA;;;4CACyBlB,S,EAAW;AACpC,OAAMoN,QAAQtN,iBAAiB,KAAKS,KAAtB,EAA6BP,SAA7B,CAAd;;AAEA,OAAMqN,cAAcC,qBACnB,KAAKlL,KAAL,CAAWf,MADQ,EAEnB,KAAKe,KAAL,CAAWZ,SAFQ,EAGnB,KAAKY,KAAL,CAAWG,QAHQ,CAApB;AAHoC,OAQfU,kBARe,GAQQ,KAAKb,KARb,CAQ5BO,WAR4B;;;AAUpC,OAAIG,iBAAJ;AACA,OAAI,CAACuK,WAAD,IAAgBD,KAAhB,IAAyB,CAAC,yBAAa,KAAK7M,KAAL,CAAWqE,QAAxB,EAAkC5E,UAAU4E,QAA5C,CAA9B,EAAqF;AACpF,QAAI3C,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;AAC1C,SAAI,CAACkL,WAAL,EAAkBzN,IAAI,iDAAJ,EAAlB,KACK,IAAIwN,KAAJ,EACJxN,IAAI,iDAAJ,EAAuDC,oBAAvD,EADI,KAEAD,IAAI,kBAAJ;AACL;AACD;AACAkD,eAAWf,WAAW/B,SAAX,CAAX;AACA,IATD,MASO;AAAA,+BACe,KAAKoC,KAAL,CAAWf,MAAX,CAAkBuB,MAAlB,EADf;AAAA;AAAA,QACCO,KADD;AAAA,QACQC,GADR;;AAEN,QAAMmK,eAAe,iBAAK,KAAKrM,QAAV,CAArB;;AAEA,QAAMsM,kBAAkBvM,kBAAkBjB,SAAlB,CAAxB;AAJM,QAKEwB,SALF,GAKgBgM,eALhB,CAKEhM,SALF;;AAMN,QAAMwB,qBACLxB,UAAU+L,YAAV,KAA2BnK,GAA3B,IAAkC5B,UAAU+L,YAAV,KAA2BpK,KAD9D;;AAGA,QAAIlB,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;AAC1C,SAAI,KAAK5B,KAAL,CAAWY,IAAX,KAAoBnB,UAAUmB,IAAlC,EACCvB,IACC,wHADD,EAECoD,kBAFD,EADD,KAMCpD,IACC,+EADD;AAGD;;AAEDkD,eAAWD,YACV2K,eADU,EAEV,KAAKpL,KAAL,CAAWf,MAFD,EAGVrB,SAHU,EAIVgD,kBAJU,EAKVC,kBALU,CAAX;AAOA;;AAhDmC,mBAkDLH,QAlDK;AAAA,OAkD5B5B,QAlD4B,aAkD5BA,QAlD4B;AAAA,OAkDfkB,KAlDe;;AAoDpC,OAAI,KAAKkG,aAAT,EAAwB;AACvB,QAAIrG,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;AAC1CvC,SAAI,oBAAJ;AACA;AACD,IAJD,MAIO;AACN;;;;;;;;;;;;;AAaA,SAAKwL,gBAAL;;AAEA,SAAKG,QAAL,CAAcnJ,KAAd;AACA;AACD,QAAKlB,QAAL,GAAgBA,QAAhB;AACA;AACD;;;;;;;;+BAKa6K,O,EAAS;AAAA,OACbpJ,WADa,GACG,KAAKP,KADR,CACbO,WADa;;AAErB,OAAI8K,UAAU,KAAd;AACA,OAAMC,iBAAiB/K,YAAY2B,GAAZ,CAAgB,gBAAQ;AAC9C,QACC,CAAC,yBAAayH,OAAb,KAAyB3G,KAAK6D,EAAL,KAAY8C,OAAtC,KACA,CAAC,yBAAa3G,KAAK4G,MAAL,CAAYpJ,MAAZ,EAAb,EAAmCwC,KAAKuI,WAAxC,CAFF,EAGE;AACDF,eAAU,IAAV;AACA,yBACIrI,IADJ;AAEC4G,cAAQ5G,KAAK4G,MAAL,CAAYpJ,MAAZ,CAAmBwC,KAAKuI,WAAxB,CAFT;AAGC1B,mBAAa;AAHd;AAKA;AACD,WAAO7G,IAAP;AACA,IAbsB,CAAvB;;AAeA,OAAIqI,OAAJ,EAAa;AACZ,SAAKrC,gBAAL;AACA,SAAKG,QAAL,CAAc;AACb5I,kBAAa+K;AADA,KAAd;AAGA;AACD;;;0CACuB;AACvB;AACA,UAAO,CAAC,KAAKpF,aAAb;AACA;;;2BACQ;AAAA,iBAcJ,KAAK/H,KAdD;AAAA,OAEP2L,IAFO,WAEPA,IAFO;AAAA,OAGP1L,MAHO,WAGPA,MAHO;AAAA,OAIPI,KAJO,WAIPA,KAJO;AAAA,OAKPH,MALO,WAKPA,MALO;AAAA,OAMP+I,SANO,WAMPA,SANO;AAAA,OAOPoE,MAPO,WAOPA,MAPO;AAAA,OAQPC,YARO,WAQPA,YARO;AAAA,OASP9E,KATO,WASPA,KATO;AAAA,OAUP+E,cAVO,WAUPA,cAVO;AAAA,OAWPC,QAXO,WAWPA,QAXO;AAAA,OAYPC,SAZO,WAYPA,SAZO;AAAA,OAaPC,aAbO,WAaPA,aAbO;AAAA,iBAesC,KAAK1N,KAf3C;AAAA,OAeA2N,uBAfA,WAeAA,uBAfA;AAAA,OAeyBC,QAfzB,WAeyBA,QAfzB;AAAA,iBAiB6C,KAAK/L,KAjBlD;AAAA,OAiBAG,QAjBA,WAiBAA,QAjBA;AAAA,OAiBUlB,MAjBV,WAiBUA,MAjBV;AAAA,OAiBkBG,SAjBlB,WAiBkBA,SAjBlB;AAAA,OAiB6BmB,WAjB7B,WAiB6BA,WAjB7B;;AAkBR,OAAMD,aAAapC,cAAc,KAAKC,KAAnB,CAAnB;;AAEA,OAAM8M,cAAcC,qBAAqBjM,MAArB,EAA6BG,SAA7B,EAAwCe,QAAxC,CAApB;;AAEA,OAAM6L,cAAcF,2BAA2Bb,WAA/C;AACA,OAAMgB,SAASjO,gBAAf;AACA,UACC;AAAA;AAAA;AACC,YAAO,EAAEkO,UAAU,UAAZ,EAAwB1N,YAAxB,EAA+BJ,cAA/B,EADR;AAEC,gBAAWgJ,SAFZ;AAGC,cAAS2E;AAHV;AAKC,kCAAC,yBAAD;AACC,UAAK,KAAKjG,uBADX;AAEC,WAAMgE,IAFP;AAGC,YAAOnD,KAHR;AAIC,YAAOnI,KAJR;AAKC,aAAQJ,MALT;AAMC,aAAQoN;AANT,MALD;AAaC;AAAA;AAAA;AACC,iBAAWpE,SADZ;AAEC,aAAO5I,KAFR;AAGC,cAAQJ,MAHT;AAIC,aAAO,EAAE8N,UAAU,UAAZ,EAAwBV,QAAQA,SAAS,CAAzC;AAJR;AAMES,WANF;AAOC;AAAA;AAAA;AACC;AAAA;AAAA,SAAU,IAAG,iBAAb;AACC,+CAAM,GAAE,GAAR,EAAY,GAAE,GAAd,EAAkB,OAAO3L,WAAW9B,KAApC,EAA2C,QAAQ8B,WAAWlC,MAA9D;AADD,OADD;AAIC;AAAA;AAAA,SAAgB,IAAG,UAAnB,EAA8B,IAAG,IAAjC,EAAsC,IAAG,IAAzC,EAA8C,IAAG,IAAjD,EAAsD,IAAG,MAAzD;AACC,+CAAM,WAAWyN,aAAjB,EAAgC,aAAY,MAA5C,EAAmD,QAAO,IAA1D,GADD;AAEC,+CAAM,WAAWA,aAAjB,EAAgC,aAAY,MAA5C,EAAmD,QAAO,KAA1D,GAFD;AAGC,+CAAM,WAAWA,aAAjB,EAAgC,aAAY,GAA5C,EAAgD,QAAO,MAAvD;AAHD,OAJD;AASEtL,kBAAY2B,GAAZ,CAAgB,UAACc,IAAD,EAAOmJ,GAAP;AAAA,cAChB;AAAA;AAAA,UAAU,KAAKA,GAAf,EAAoB,yBAAuBnJ,KAAK6D,EAAhD;AACC,gDAAM,GAAE,GAAR,EAAY,GAAE,GAAd,EAAkB,OAAO7D,KAAKxE,KAA9B,EAAqC,QAAQwE,KAAK5E,MAAlD;AADD,QADgB;AAAA,OAAhB;AATF,MAPD;AAsBC;AAAA;AAAA,QAAG,2BAAwBC,OAAOI,IAAP,GAAc,GAAtC,YAA8CJ,OAAOC,GAAP,GAAa,GAA3D,OAAH;AACC,oCAAC,sBAAD;AACC,YAAK,KAAKuH,oBADX;AAEC,gCAAyBmG,WAF1B;AAGC,kBAAWN,kBAAkBT,WAH9B;AAIC,aAAMW,aAAaX,WAJpB;AAKC,YAAKU,YAAYV,WALlB;AAMC,cAAO3K,WAAW9B,KANnB;AAOC,eAAQ8B,WAAWlC,MAPpB;AAQC,oBAAamC,WARd;AASC,eAAQtB,MATT;AAUC,kBAAWG,SAVZ;AAWC,cAAOqM,YAXR;AAYC,2BAAoB,KAAKtN,KAAL,CAAWiO,kBAZhC;AAaC,4BAAqB,KAAK5G,mBAb3B;AAcC,sBAAe,KAAKb,iBAdrB;AAeC,gBAAS,KAAKH,WAff;AAgBC,sBAAe,KAAKE,iBAhBrB;AAiBC,oBAAa,KAAKD,eAjBnB;AAkBC,oBAAa,KAAKT,eAlBnB;AAmBC,qBAAc,KAAKC,gBAnBpB;AAoBC,qBAAc,KAAKC,gBApBpB;AAqBC,oBAAa,KAAKU,eArBnB;AAsBC,eAAQ,KAAKC,UAtBd;AAuBC,uBAAgB,KAAKC,aAvBtB;AAwBC,eAAQ,KAAKX,UAxBd;AAyBC,oBAAa,KAAKC,eAzBnB;AA0BC,uBAAgB,KAAKC,kBA1BtB;AA2BC,cAAO,KAAKC,SA3Bb;AA4BC,iBAAU,KAAKC;AA5BhB,QADD;AAgCC;AAAA;AAAA,SAAG,WAAU,qCAAb;AAAoD,YAAKpG,KAAL,CAAWkC;AAA/D;AAhCD;AAtBD;AAbD,IADD;AAyEA;;;;EA53BwBgM,gB;;AA+3B1B,SAASnB,oBAAT,CAA8BjM,MAA9B,EAAsCG,SAAtC,EAAiDL,IAAjD,EAAuD;AACtD,KAAMkM,cAAc,CAAC/H,MAAMjE,OAAOG,UAAU,iBAAKL,IAAL,CAAV,CAAP,CAAN,CAAD,IAAyC,sBAAUE,OAAOmD,MAAjB,CAA7D;AACA,QAAO6I,WAAP;AACA;;AAEDrH,YAAY0I,SAAZ,GAAwB;AACvB9N,QAAO+N,oBAAUC,MAAV,CAAiBC,UADD;AAEvBrO,SAAQmO,oBAAUC,MAAV,CAAiBC,UAFF;AAGvBpO,SAAQkO,oBAAUG,MAHK;AAIvB/F,QAAO4F,oBAAUC,MAAV,CAAiBC,UAJD;AAKvB;AACA3C,OAAMyC,oBAAUI,KAAV,CAAgB,CAAC,KAAD,EAAQ,QAAR,CAAhB,CANiB;AAOvBxN,uBAAsBoN,oBAAUC,MAPT;AAQvBlN,0BAAyBiN,oBAAUC,MARZ;AASvBzN,OAAMwN,oBAAUK,KAAV,CAAgBH,UATC;AAUvB;AACArN,YAAWmN,oBAAUM,IAXE;AAYvBrK,WAAU+J,oBAAUO,SAAV,CAAoB,CAACP,oBAAUK,KAAX,EAAkBL,oBAAUM,IAA5B,CAApB,CAZa;AAavBvD,aAAYiD,oBAAUM,IAbC;;AAevBzF,YAAWmF,oBAAUQ,MAfE;AAgBvBC,aAAYT,oBAAUQ,MAAV,CAAiBN,UAhBN;AAiBvBjB,SAAQe,oBAAUC,MAjBK;AAkBvBnM,WAAUkM,oBAAUlG,IAAV,CAAeoG,UAlBF;AAmBvBxN,SAAQsN,oBAAUM,IAAV,CAAeJ,UAnBA;AAoBvBrM,iBAAgBmM,oBAAUM,IApBH;AAqBvBjO,aAAY2N,oBAAUU,IArBC;AAsBvBnB,0BAAyBS,oBAAUU,IAtBZ;AAuBvBhM,UAASsL,oBAAUO,SAAV,CAAoB,CAC5BP,oBAAUC,MADkB,EAE5BD,oBAAUW,KAAV,CAAgB;AACfzO,QAAM8N,oBAAUC,MADD;AAEf9N,SAAO6N,oBAAUC;AAFF,EAAhB,CAF4B,CAApB,CAvBc;AA8BvBf,eAAcc,oBAAUU,IA9BD;AA+BvB5D,iBAAgBkD,oBAAUC,MA/BH;AAgCvBtD,aAAYqD,oBAAUM,IAhCC;AAiCvBxN,mBAAkB,0BAASlB,KAAT,EAAgBgP,QAAhB,CAAyB,qBAAzB,EAAgD;AACjE,MAAI,yBAAahP,MAAMgP,QAAN,CAAb,CAAJ,EAAmC;AAClCC,WAAQC,IAAR,CACC,uCACC,6DADD,GAEC,2DAFD,GAGC,oEAJF;AAMA,GAPD,MAOO,IAAI,OAAOlP,MAAMgP,QAAN,CAAP,KAA2B,UAA/B,EAA2C;AACjD,UAAO,IAAItK,KAAJ,CAAU,uCAAV,CAAP;AACA;AACD,EA5CsB;AA6CvB6I,iBAAgBa,oBAAUU,IA7CH;AA8CvBtB,WAAUY,oBAAUU,IA9CG;AA+CvB/N,QAAOqN,oBAAUO,SAAV,CAAoB,CAACP,oBAAUQ,MAAX,EAAmBR,oBAAUU,IAA7B,EAAmCV,oBAAUM,IAA7C,CAApB,CA/CgB;AAgDvBjB,YAAWW,oBAAUU,IAhDE;AAiDvBlB,WAAUQ,oBAAUM,IAjDG;AAkDvB3L,iCAAgCqL,oBAAUU,IAlDnB;AAmDvBb,qBAAoBG,oBAAUU;AAnDP,CAAxB;;AAsDArJ,YAAY0J,YAAZ,GAA2B;AAC1BjP,SAAQ,EAAEC,KAAK,EAAP,EAAWI,OAAO,EAAlB,EAAsBH,QAAQ,EAA9B,EAAkCE,MAAM,EAAxC,EADkB;AAE1BqL,OAAM,QAFoB;AAG1B3K,uBAAsB,CAHI;AAI1BG,0BAAyB,IAAI,GAJH;AAK1B8H,YAAW,kBALe;AAM1BoE,SAAQ,CANkB;AAO1BhJ,WAAU,CAACiB,YAAD,EAAME,YAAN,CAPgB;AAQ1BvD,iBAAgBZ,eARU;AAS1ByB,UAAS,CATiB;AAU1B7B,YAAWI,eAVe;AAW1BZ,aAAY,KAXc;AAY1BkN,0BAAyB,IAZC;AAa1BL,eAAc,IAbY;AAc1BvC,aAAYqE,WAdc;AAe1BxB,WAAUwB,WAfgB;AAgB1B7B,iBAAgB,IAhBU;AAiB1BC,WAAU,IAjBgB;AAkB1BC,YAAW,IAlBe;AAmB1BvC,iBAAgB,GAnBU;AAoB1BnK,QAAO,KApBmB;AAqB1BoK,aAAYkE,kCArBc;AAsB1BtM,iCAAgC,IAtBN;AAuB1B;AACAkL,qBAAoB;AAxBM,CAA3B;;AA2BAxI,YAAY6J,iBAAZ,GAAgC;AAC/BtN,WAAUoM,oBAAUK,KADW;AAE/B9N,WAAUyN,oBAAUK,KAFW;AAG/BrM,cAAagM,oBAAUmB,OAAV,CACZnB,oBAAUW,KAAV,CAAgB;AACfrG,MAAI0F,oBAAUO,SAAV,CAAoB,CAACP,oBAAUC,MAAX,EAAmBD,oBAAUQ,MAA7B,CAApB,EAA0DN,UAD/C;AAEfkB,UAAQpB,oBAAUmB,OAAV,CAAkBnB,oBAAUC,MAA5B,EAAoCC,UAF7B;AAGfxL,WAASsL,oBAAUO,SAAV,CAAoB,CAC5BP,oBAAUC,MADkB,EAE5BD,oBAAUW,KAAV,CAAgB;AACf5O,QAAKiO,oBAAUC,MADA;AAEfjO,WAAQgO,oBAAUC;AAFH,GAAhB,CAF4B,CAApB,CAHM;AAUfoB,YAAUrB,oBAAUmB,OAAV,CAAkBnB,oBAAUM,IAA5B,CAVK;AAWfgB,oBAAkBtB,oBAAUM,IAXb;AAYfjD,UAAQ2C,oBAAUM,IAAV,CAAeJ,UAZR;AAafqB,oBAAkBvB,oBAAUW,KAAV,CAAgB;AACjCa,OAAIxB,oBAAUQ,MADmB;AAEjCiB,WAAQzB,oBAAUM;AAFe,GAAhB,CAbH;AAiBfrO,SAAO+N,oBAAUC,MAAV,CAAiBC,UAjBT;AAkBfrO,UAAQmO,oBAAUC,MAAV,CAAiBC;AAlBV,EAAhB,CADY,EAqBXA,UAxB6B;AAyB/BxN,SAAQsN,oBAAUM,IAAV,CAAeJ,UAzBQ;AA0B/BrN,YAAWmN,oBAAUM,IAAV,CAAeJ,UA1BK;AA2B/BpN,mBAAkBkN,oBAAUM,IAAV,CAAeJ,UA3BF;AA4B/BjO,QAAO+N,oBAAUC,MAAV,CAAiBC,UA5BO;AA6B/BrO,SAAQmO,oBAAUC,MAAV,CAAiBC,UA7BM;AA8B/B1B,kBAAiBwB,oBAAUI,KAAV,CAAgB,CAAC,KAAD,EAAQ,QAAR,CAAhB,EAAmCF,UA9BrB;AA+B/BpO,SAAQkO,oBAAUG,MAAV,CAAiBD,UA/BM;AAgC/B9F,QAAO4F,oBAAUC,MAAV,CAAiBC,UAhCO;AAiC/B1I,oBAAmBwI,oBAAUM,IAjCE;AAkC/B5H,YAAWsH,oBAAUM,IAlCU;AAmC/B3H,YAAWqH,oBAAUM,IAnCU;AAoC/BjH,WAAU2G,oBAAUM,IApCW;AAqC/BtH,SAAQgH,oBAAUM,IArCa;AAsC/BnH,YAAW6G,oBAAUM,IAtCU;AAuC/BlH,cAAa4G,oBAAUM,IAvCQ;AAwC/B9G,iBAAgBwG,oBAAUM,IAxCK;AAyC/BxH,yBAAwBkH,oBAAUM,IAzCH;AA0C/B7G,kBAAiBuG,oBAAUM;AA1CI,CAAhC;;AA6CAjJ,YAAYqK,KAAZ,GAAoB;AAAA,QAAM;AACzBC,QAAMnL,EAAEmL,IADiB;AAEzBC,QAAMpL,EAAEoL,IAFiB;AAGzBC,QAAMrL,EAAEqL,IAHiB;AAIzBC,OAAKtL,EAAEsL,GAJkB;AAKzBC,SAAOvL,EAAEuL,KALgB;AAMzBC,UAAQxL,EAAEwL;AANe,EAAN;AAAA,CAApB;;kBASe3K,W","file":"ChartCanvas.js","sourcesContent":["import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { extent as d3Extent, min, max } from \"d3-array\";\n\nimport {\n\thead,\n\tlast,\n\tisDefined,\n\tisNotDefined,\n\tclearCanvas,\n\tshallowEqual,\n\tidentity,\n\tnoop,\n\tfunctor,\n\tgetLogger,\n} from \"./utils\";\n\n/* eslint-disable no-unused-vars */\nimport {\n\tmouseBasedZoomAnchor,\n\tlastVisibleItemBasedZoomAnchor,\n\trightDomainBasedZoomAnchor,\n} from \"./utils/zoomBehavior\";\n/* eslint-enable no-unused-vars */\n\nimport {\n\tgetNewChartConfig,\n\tgetChartConfigWithUpdatedYScales,\n\tgetCurrentCharts,\n\tgetCurrentItem,\n} from \"./utils/ChartDataUtil\";\n\nimport EventCapture from \"./EventCapture\";\n\nimport CanvasContainer from \"./CanvasContainer\";\nimport evaluator from \"./scale/evaluator\";\n\nconst log = getLogger(\"ChartCanvas\");\n\nconst CANDIDATES_FOR_RESET = [\n\t\"seriesName\",\n\t/* \"data\",*/\n\t/* \"xAccessor\",*/\n];\n\nfunction shouldResetChart(thisProps, nextProps) {\n\treturn !CANDIDATES_FOR_RESET.every(key => {\n\t\tconst result = shallowEqual(thisProps[key], nextProps[key]);\n\t\t// console.log(key, result);\n\t\treturn result;\n\t});\n}\n\nfunction getCursorStyle() {\n\tconst tooltipStyle = `\n\t.react-stockcharts-grabbing-cursor {\n\t\tpointer-events: all;\n\t\tcursor: -moz-grabbing;\n\t\tcursor: -webkit-grabbing;\n\t\tcursor: grabbing;\n\t}\n\t.react-stockcharts-crosshair-cursor {\n\t\tpointer-events: all;\n\t\tcursor: crosshair;\n\t}\n\t.react-stockcharts-tooltip-hover {\n\t\tpointer-events: all;\n\t\tcursor: pointer;\n\t}\n\t.react-stockcharts-avoid-interaction {\n\t\tpointer-events: none;\n\t}\n\t.react-stockcharts-enable-interaction {\n\t\tpointer-events: all;\n\t}\n\t.react-stockcharts-tooltip {\n\t\tpointer-events: all;\n\t\tcursor: pointer;\n\t}\n\t.react-stockcharts-default-cursor {\n\t\tcursor: default;\n\t}\n\t.react-stockcharts-move-cursor {\n\t\tcursor: move;\n\t}\n\t.react-stockcharts-pointer-cursor {\n\t\tcursor: pointer;\n\t}\n\t.react-stockcharts-ns-resize-cursor {\n\t\tcursor: ns-resize;\n\t}\n\t.react-stockcharts-ew-resize-cursor {\n\t\tcursor: ew-resize;\n\t}`;\n\treturn <style type=\"text/css\">{tooltipStyle}</style>;\n}\n\nfunction getDimensions(props) {\n\treturn {\n\t\theight: props.height - props.margin.top - props.margin.bottom,\n\t\twidth: props.width - props.margin.left - props.margin.right,\n\t};\n}\n\nfunction getXScaleDirection(flipXScale) {\n\treturn flipXScale ? -1 : 1;\n}\n\nfunction calculateFullData(props) {\n\tconst { data: fullData, plotFull, xScale, clamp, pointsPerPxThreshold, flipXScale } = props;\n\tconst { xAccessor, displayXAccessor, minPointsPerPxThreshold } = props;\n\n\tconst useWholeData = isDefined(plotFull) ? plotFull : xAccessor === identity;\n\n\tconst { filterData } = evaluator({\n\t\txScale,\n\t\tuseWholeData,\n\t\tclamp,\n\t\tpointsPerPxThreshold,\n\t\tminPointsPerPxThreshold,\n\t\tflipXScale,\n\t});\n\n\treturn {\n\t\txAccessor,\n\t\tdisplayXAccessor: displayXAccessor || xAccessor,\n\t\txScale: xScale.copy(),\n\t\tfullData,\n\t\tfilterData,\n\t};\n}\nfunction resetChart(props, firstCalculation = false) {\n\tif (process.env.NODE_ENV !== \"production\") {\n\t\tif (!firstCalculation) log(\"CHART RESET\");\n\t}\n\n\tconst state = calculateState(props);\n\tconst { xAccessor, displayXAccessor, fullData } = state;\n\tconst { plotData: initialPlotData, xScale } = state;\n\tconst { postCalculator, children } = props;\n\n\tconst plotData = postCalculator(initialPlotData);\n\n\tconst dimensions = getDimensions(props);\n\tconst chartConfig = getChartConfigWithUpdatedYScales(\n\t\tgetNewChartConfig(dimensions, children),\n\t\t{ plotData, xAccessor, displayXAccessor, fullData },\n\t\txScale.domain(),\n\t);\n\n\treturn {\n\t\t...state,\n\t\txScale,\n\t\tplotData,\n\t\tchartConfig,\n\t};\n}\n\nfunction updateChart(newState, initialXScale, props, lastItemWasVisible, initialChartConfig) {\n\tconst { fullData, xScale, xAccessor, displayXAccessor, filterData } = newState;\n\n\tconst lastItem = last(fullData);\n\tconst [start, end] = initialXScale.domain();\n\n\tif (process.env.NODE_ENV !== \"production\") {\n\t\tlog(\"TRIVIAL CHANGE\");\n\t}\n\n\tconst { postCalculator, children, padding, flipXScale } = props;\n\tconst { maintainPointsPerPixelOnResize } = props;\n\tconst direction = getXScaleDirection(flipXScale);\n\tconst dimensions = getDimensions(props);\n\n\tconst updatedXScale = setXRange(xScale, dimensions, padding, direction);\n\n\t// console.log(\"lastItemWasVisible =\", lastItemWasVisible, end, xAccessor(lastItem), end >= xAccessor(lastItem));\n\tlet initialPlotData;\n\tif (!lastItemWasVisible || end >= xAccessor(lastItem)) {\n\t\t// resize comes here...\n\t\t// get plotData between [start, end] and do not change the domain\n\t\tconst [rangeStart, rangeEnd] = initialXScale.range();\n\t\tconst [newRangeStart, newRangeEnd] = updatedXScale.range();\n\t\tconst newDomainExtent =\n\t\t\t(newRangeEnd - newRangeStart) / (rangeEnd - rangeStart) * (end - start);\n\t\tconst newStart = maintainPointsPerPixelOnResize ? end - newDomainExtent : start;\n\n\t\tconst lastItemX = initialXScale(xAccessor(lastItem));\n\t\t// console.log(\"pointsPerPixel => \", newStart, start, end, updatedXScale(end));\n\t\tconst response = filterData(fullData, [newStart, end], xAccessor, updatedXScale, {\n\t\t\tfallbackStart: start,\n\t\t\tfallbackEnd: { lastItem, lastItemX },\n\t\t});\n\t\tinitialPlotData = response.plotData;\n\t\tupdatedXScale.domain(response.domain);\n\t\t// console.log(\"HERE!!!!!\", start, end);\n\t} else if (lastItemWasVisible && end < xAccessor(lastItem)) {\n\t\t// this is when a new item is added and last item was visible\n\t\t// so slide over and show the new item also\n\n\t\t// get plotData between [xAccessor(l) - (end - start), xAccessor(l)] and DO change the domain\n\t\tconst dx = initialXScale(xAccessor(lastItem)) - initialXScale.range()[1];\n\t\tconst [newStart, newEnd] = initialXScale\n\t\t\t.range()\n\t\t\t.map(x => x + dx)\n\t\t\t.map(initialXScale.invert);\n\n\t\tconst response = filterData(fullData, [newStart, newEnd], xAccessor, updatedXScale);\n\t\tinitialPlotData = response.plotData;\n\t\tupdatedXScale.domain(response.domain); // if last item was visible, then shift\n\t}\n\t// plotData = getDataOfLength(fullData, showingInterval, plotData.length)\n\tconst plotData = postCalculator(initialPlotData);\n\tconst chartConfig = getChartConfigWithUpdatedYScales(\n\t\tgetNewChartConfig(dimensions, children, initialChartConfig),\n\t\t{ plotData, xAccessor, displayXAccessor, fullData },\n\t\tupdatedXScale.domain(),\n\t);\n\n\treturn {\n\t\txScale: updatedXScale,\n\t\txAccessor,\n\t\tchartConfig,\n\t\tplotData,\n\t\tfullData,\n\t\tfilterData,\n\t};\n}\n\nfunction calculateState(props) {\n\tconst { xAccessor: inputXAccesor, xExtents: xExtentsProp, data, padding, flipXScale } = props;\n\n\tif (process.env.NODE_ENV !== \"production\" && isDefined(props.xScale.invert)) {\n\t\tfor (let i = 1; i < data.length; i++) {\n\t\t\tconst prev = data[i - 1];\n\t\t\tconst curr = data[i];\n\t\t\tif (inputXAccesor(prev) > inputXAccesor(curr)) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t\"'data' is not sorted on 'xAccessor', send 'data' sorted in ascending order of 'xAccessor'\",\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tconst direction = getXScaleDirection(flipXScale);\n\tconst dimensions = getDimensions(props);\n\n\tconst extent =\n\t\ttypeof xExtentsProp === \"function\"\n\t\t\t? xExtentsProp(data)\n\t\t\t: d3Extent(xExtentsProp.map(d => functor(d)).map(each => each(data, inputXAccesor)));\n\n\tconst { xAccessor, displayXAccessor, xScale, fullData, filterData } = calculateFullData(props);\n\tconst updatedXScale = setXRange(xScale, dimensions, padding, direction);\n\n\tconst { plotData, domain } = filterData(fullData, extent, inputXAccesor, updatedXScale);\n\n\tif (process.env.NODE_ENV !== \"production\" && plotData.length <= 1) {\n\t\tthrow new Error(\n\t\t\t`Showing ${plotData.length} datapoints, review the 'xExtents' prop of ChartCanvas`,\n\t\t);\n\t}\n\treturn {\n\t\tplotData,\n\t\txScale: updatedXScale.domain(domain),\n\t\txAccessor,\n\t\tdisplayXAccessor,\n\t\tfullData,\n\t\tfilterData,\n\t};\n}\n\nfunction setXRange(xScale, dimensions, padding, direction = 1) {\n\tif (xScale.rangeRoundPoints) {\n\t\tif (isNaN(padding)) throw new Error(\"padding has to be a number for ordinal scale\");\n\t\txScale.rangeRoundPoints([0, dimensions.width], padding);\n\t} else if (xScale.padding) {\n\t\tif (isNaN(padding)) throw new Error(\"padding has to be a number for ordinal scale\");\n\t\txScale.range([0, dimensions.width]);\n\t\txScale.padding(padding / 2);\n\t} else {\n\t\tconst { left, right } = isNaN(padding) ? padding : { left: padding, right: padding };\n\t\tif (direction > 0) {\n\t\t\txScale.range([left, dimensions.width - right]);\n\t\t} else {\n\t\t\txScale.range([dimensions.width - right, left]);\n\t\t}\n\t}\n\treturn xScale;\n}\n\nfunction pinchCoordinates(pinch) {\n\tconst { touch1Pos, touch2Pos } = pinch;\n\n\treturn {\n\t\ttopLeft: [Math.min(touch1Pos[0], touch2Pos[0]), Math.min(touch1Pos[1], touch2Pos[1])],\n\t\tbottomRight: [Math.max(touch1Pos[0], touch2Pos[0]), Math.max(touch1Pos[1], touch2Pos[1])],\n\t};\n}\n\nclass ChartCanvas extends Component {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.getDataInfo = this.getDataInfo.bind(this);\n\t\tthis.getCanvasContexts = this.getCanvasContexts.bind(this);\n\n\t\tthis.handleMouseMove = this.handleMouseMove.bind(this);\n\t\tthis.handleMouseEnter = this.handleMouseEnter.bind(this);\n\t\tthis.handleMouseLeave = this.handleMouseLeave.bind(this);\n\t\tthis.handleZoom = this.handleZoom.bind(this);\n\t\tthis.handlePinchZoom = this.handlePinchZoom.bind(this);\n\t\tthis.handlePinchZoomEnd = this.handlePinchZoomEnd.bind(this);\n\t\tthis.handlePan = this.handlePan.bind(this);\n\t\tthis.handlePanEnd = this.handlePanEnd.bind(this);\n\t\tthis.handleClick = this.handleClick.bind(this);\n\t\tthis.handleMouseDown = this.handleMouseDown.bind(this);\n\t\tthis.handleDoubleClick = this.handleDoubleClick.bind(this);\n\t\tthis.handleContextMenu = this.handleContextMenu.bind(this);\n\t\tthis.handleDragStart = this.handleDragStart.bind(this);\n\t\tthis.handleDrag = this.handleDrag.bind(this);\n\t\tthis.handleDragEnd = this.handleDragEnd.bind(this);\n\n\t\tthis.panHelper = this.panHelper.bind(this);\n\t\tthis.pinchZoomHelper = this.pinchZoomHelper.bind(this);\n\t\tthis.xAxisZoom = this.xAxisZoom.bind(this);\n\t\tthis.yAxisZoom = this.yAxisZoom.bind(this);\n\t\tthis.resetYDomain = this.resetYDomain.bind(this);\n\t\tthis.calculateStateForDomain = this.calculateStateForDomain.bind(this);\n\t\tthis.generateSubscriptionId = this.generateSubscriptionId.bind(this);\n\t\tthis.draw = this.draw.bind(this);\n\t\tthis.redraw = this.redraw.bind(this);\n\t\tthis.getAllPanConditions = this.getAllPanConditions.bind(this);\n\n\t\tthis.subscriptions = [];\n\t\tthis.subscribe = this.subscribe.bind(this);\n\t\tthis.unsubscribe = this.unsubscribe.bind(this);\n\t\tthis.amIOnTop = this.amIOnTop.bind(this);\n\t\tthis.saveEventCaptureNode = this.saveEventCaptureNode.bind(this);\n\t\tthis.saveCanvasContainerNode = this.saveCanvasContainerNode.bind(this);\n\t\tthis.setCursorClass = this.setCursorClass.bind(this);\n\t\tthis.getMutableState = this.getMutableState.bind(this);\n\t\t// this.canvasDrawCallbackList = [];\n\t\tthis.interactiveState = [];\n\t\tthis.panInProgress = false;\n\n\t\tthis.state = {};\n\t\tthis.mutableState = {};\n\t\tthis.lastSubscriptionId = 0;\n\t}\n\tsaveEventCaptureNode(node) {\n\t\tthis.eventCaptureNode = node;\n\t}\n\tsaveCanvasContainerNode(node) {\n\t\tthis.canvasContainerNode = node;\n\t}\n\tgetMutableState() {\n\t\treturn this.mutableState;\n\t}\n\tgetDataInfo() {\n\t\treturn {\n\t\t\t...this.state,\n\t\t\tfullData: this.fullData,\n\t\t};\n\t}\n\tgetCanvasContexts() {\n\t\tif (this.canvasContainerNode) {\n\t\t\treturn this.canvasContainerNode.getCanvasContexts();\n\t\t}\n\t}\n\tgenerateSubscriptionId() {\n\t\tthis.lastSubscriptionId++;\n\t\treturn this.lastSubscriptionId;\n\t}\n\tclearBothCanvas() {\n\t\tconst canvases = this.getCanvasContexts();\n\t\tif (canvases && canvases.axes) {\n\t\t\tclearCanvas(\n\t\t\t\t[\n\t\t\t\t\tcanvases.axes,\n\t\t\t\t\t// canvases.hover,\n\t\t\t\t\tcanvases.mouseCoord,\n\t\t\t\t],\n\t\t\t\tthis.props.ratio,\n\t\t\t);\n\t\t}\n\t}\n\tclearMouseCanvas() {\n\t\tconst canvases = this.getCanvasContexts();\n\t\tif (canvases && canvases.mouseCoord) {\n\t\t\tclearCanvas(\n\t\t\t\t[\n\t\t\t\t\tcanvases.mouseCoord,\n\t\t\t\t\t// canvases.hover,\n\t\t\t\t],\n\t\t\t\tthis.props.ratio,\n\t\t\t);\n\t\t}\n\t}\n\tclearThreeCanvas() {\n\t\tconst canvases = this.getCanvasContexts();\n\t\tif (canvases && canvases.axes) {\n\t\t\tclearCanvas(\n\t\t\t\t[\n\t\t\t\t\tcanvases.axes,\n\t\t\t\t\t// canvases.hover,\n\t\t\t\t\tcanvases.mouseCoord,\n\t\t\t\t\tcanvases.bg,\n\t\t\t\t],\n\t\t\t\tthis.props.ratio,\n\t\t\t);\n\t\t}\n\t}\n\tsubscribe(id, rest) {\n\t\tconst {\n\t\t\tgetPanConditions = functor({\n\t\t\t\tdraggable: false,\n\t\t\t\tpanEnabled: true,\n\t\t\t}),\n\t\t} = rest;\n\t\tthis.subscriptions = this.subscriptions.concat({\n\t\t\tid,\n\t\t\t...rest,\n\t\t\tgetPanConditions,\n\t\t});\n\t}\n\tunsubscribe(id) {\n\t\tthis.subscriptions = this.subscriptions.filter(each => each.id !== id);\n\t}\n\tgetAllPanConditions() {\n\t\treturn this.subscriptions.map(each => each.getPanConditions());\n\t}\n\tsetCursorClass(className) {\n\t\tthis.eventCaptureNode.setCursorClass(className);\n\t}\n\tamIOnTop(id) {\n\t\tconst dragableComponents = this.subscriptions.filter(\n\t\t\teach => each.getPanConditions().draggable,\n\t\t);\n\n\t\treturn dragableComponents.length > 0 && last(dragableComponents).id === id;\n\t}\n\thandleContextMenu(mouseXY, e) {\n\t\tconst { xAccessor, chartConfig, plotData, xScale } = this.state;\n\n\t\tconst currentCharts = getCurrentCharts(chartConfig, mouseXY);\n\t\tconst currentItem = getCurrentItem(xScale, xAccessor, mouseXY, plotData);\n\n\t\tthis.triggerEvent(\n\t\t\t\"contextmenu\",\n\t\t\t{\n\t\t\t\tmouseXY,\n\t\t\t\tcurrentItem,\n\t\t\t\tcurrentCharts,\n\t\t\t},\n\t\t\te,\n\t\t);\n\t}\n\tcalculateStateForDomain(newDomain) {\n\t\tconst {\n\t\t\txAccessor,\n\t\t\tdisplayXAccessor,\n\t\t\txScale: initialXScale,\n\t\t\tchartConfig: initialChartConfig,\n\t\t\tplotData: initialPlotData,\n\t\t} = this.state;\n\t\tconst { filterData } = this.state;\n\t\tconst { fullData } = this;\n\t\tconst { postCalculator } = this.props;\n\n\t\tconst { plotData: beforePlotData, domain } = filterData(\n\t\t\tfullData,\n\t\t\tnewDomain,\n\t\t\txAccessor,\n\t\t\tinitialXScale,\n\t\t\t{\n\t\t\t\tcurrentPlotData: initialPlotData,\n\t\t\t\tcurrentDomain: initialXScale.domain(),\n\t\t\t},\n\t\t);\n\n\t\tconst plotData = postCalculator(beforePlotData);\n\t\tconst updatedScale = initialXScale.copy().domain(domain);\n\t\tconst chartConfig = getChartConfigWithUpdatedYScales(\n\t\t\tinitialChartConfig,\n\t\t\t{ plotData, xAccessor, displayXAccessor, fullData },\n\t\t\tupdatedScale.domain(),\n\t\t);\n\n\t\treturn {\n\t\t\txScale: updatedScale,\n\t\t\tplotData,\n\t\t\tchartConfig,\n\t\t};\n\t}\n\tpinchZoomHelper(initialPinch, finalPinch) {\n\t\tconst { xScale: initialPinchXScale } = initialPinch;\n\n\t\tconst {\n\t\t\txScale: initialXScale,\n\t\t\tchartConfig: initialChartConfig,\n\t\t\tplotData: initialPlotData,\n\t\t\txAccessor,\n\t\t\tdisplayXAccessor,\n\t\t} = this.state;\n\t\tconst { filterData } = this.state;\n\t\tconst { fullData } = this;\n\t\tconst { postCalculator } = this.props;\n\n\t\tconst { topLeft: iTL, bottomRight: iBR } = pinchCoordinates(initialPinch);\n\t\tconst { topLeft: fTL, bottomRight: fBR } = pinchCoordinates(finalPinch);\n\n\t\tconst e = initialPinchXScale.range()[1];\n\n\t\tconst xDash = Math.round(-(iBR[0] * fTL[0] - iTL[0] * fBR[0]) / (iTL[0] - iBR[0]));\n\t\tconst yDash = Math.round(\n\t\t\te +\n\t\t\t\t((e - iBR[0]) * (e - fTL[0]) - (e - iTL[0]) * (e - fBR[0])) /\n\t\t\t\t\t(e - iTL[0] - (e - iBR[0])),\n\t\t);\n\n\t\tconst x = Math.round(-xDash * iTL[0] / (-xDash + fTL[0]));\n\t\tconst y = Math.round(e - (yDash - e) * (e - iTL[0]) / (yDash + (e - fTL[0])));\n\n\t\tconst newDomain = [x, y].map(initialPinchXScale.invert);\n\t\t// var domainR = initial.right + right;\n\n\t\tconst { plotData: beforePlotData, domain } = filterData(\n\t\t\tfullData,\n\t\t\tnewDomain,\n\t\t\txAccessor,\n\t\t\tinitialPinchXScale,\n\t\t\t{\n\t\t\t\tcurrentPlotData: initialPlotData,\n\t\t\t\tcurrentDomain: initialXScale.domain(),\n\t\t\t},\n\t\t);\n\n\t\tconst plotData = postCalculator(beforePlotData);\n\t\tconst updatedScale = initialXScale.copy().domain(domain);\n\n\t\tconst mouseXY = finalPinch.touch1Pos;\n\t\tconst chartConfig = getChartConfigWithUpdatedYScales(\n\t\t\tinitialChartConfig,\n\t\t\t{ plotData, xAccessor, displayXAccessor, fullData },\n\t\t\tupdatedScale.domain(),\n\t\t);\n\t\tconst currentItem = getCurrentItem(updatedScale, xAccessor, mouseXY, plotData);\n\n\t\treturn {\n\t\t\tchartConfig,\n\t\t\txScale: updatedScale,\n\t\t\tplotData,\n\t\t\tmouseXY,\n\t\t\tcurrentItem,\n\t\t};\n\t}\n\tcancelDrag() {\n\t\tthis.eventCaptureNode.cancelDrag();\n\t\tthis.triggerEvent(\"dragcancel\");\n\t}\n\thandlePinchZoom(initialPinch, finalPinch, e) {\n\t\tif (!this.waitingForPinchZoomAnimationFrame) {\n\t\t\tthis.waitingForPinchZoomAnimationFrame = true;\n\t\t\tconst state = this.pinchZoomHelper(initialPinch, finalPinch);\n\n\t\t\tthis.triggerEvent(\"pinchzoom\", state, e);\n\n\t\t\tthis.finalPinch = finalPinch;\n\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tthis.clearBothCanvas();\n\t\t\t\tthis.draw({ trigger: \"pinchzoom\" });\n\t\t\t\tthis.waitingForPinchZoomAnimationFrame = false;\n\t\t\t});\n\t\t}\n\t}\n\thandlePinchZoomEnd(initialPinch, e) {\n\t\tconst { xAccessor } = this.state;\n\n\t\tif (this.finalPinch) {\n\t\t\tconst state = this.pinchZoomHelper(initialPinch, this.finalPinch);\n\t\t\tconst { xScale } = state;\n\t\t\tthis.triggerEvent(\"pinchzoom\", state, e);\n\n\t\t\tthis.finalPinch = null;\n\n\t\t\tthis.clearThreeCanvas();\n\n\t\t\tconst { fullData } = this;\n\t\t\tconst firstItem = head(fullData);\n\n\t\t\tconst start = head(xScale.domain());\n\t\t\tconst end = xAccessor(firstItem);\n\t\t\tconst { onLoadMore } = this.props;\n\n\t\t\tthis.setState(state, () => {\n\t\t\t\tif (start < end) {\n\t\t\t\t\tonLoadMore(start, end);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\thandleZoom(zoomDirection, mouseXY, e) {\n\t\tif (this.panInProgress) return;\n\t\t// console.log(\"zoomDirection \", zoomDirection, \" mouseXY \", mouseXY);\n\t\tconst { xAccessor, xScale: initialXScale, plotData: initialPlotData } = this.state;\n\t\tconst { zoomMultiplier, zoomAnchor } = this.props;\n\t\tconst { fullData } = this;\n\t\tconst item = zoomAnchor({\n\t\t\txScale: initialXScale,\n\t\t\txAccessor,\n\t\t\tmouseXY,\n\t\t\tplotData: initialPlotData,\n\t\t\tfullData,\n\t\t});\n\n\t\tconst cx = initialXScale(item);\n\t\tconst c = zoomDirection > 0 ? 1 * zoomMultiplier : 1 / zoomMultiplier;\n\t\tconst newDomain = initialXScale\n\t\t\t.range()\n\t\t\t.map(x => cx + (x - cx) * c)\n\t\t\t.map(initialXScale.invert);\n\n\t\tconst { xScale, plotData, chartConfig } = this.calculateStateForDomain(newDomain);\n\n\t\tconst currentItem = getCurrentItem(xScale, xAccessor, mouseXY, plotData);\n\t\tconst currentCharts = getCurrentCharts(chartConfig, mouseXY);\n\n\t\tthis.clearThreeCanvas();\n\n\t\tconst firstItem = head(fullData);\n\n\t\tconst start = head(xScale.domain());\n\t\tconst end = xAccessor(firstItem);\n\t\tconst { onLoadMore } = this.props;\n\n\t\tthis.mutableState = {\n\t\t\tmouseXY: mouseXY,\n\t\t\tcurrentItem: currentItem,\n\t\t\tcurrentCharts: currentCharts,\n\t\t};\n\n\t\tthis.triggerEvent(\n\t\t\t\"zoom\",\n\t\t\t{\n\t\t\t\txScale,\n\t\t\t\tplotData,\n\t\t\t\tchartConfig,\n\t\t\t\tmouseXY,\n\t\t\t\tcurrentCharts,\n\t\t\t\tcurrentItem,\n\t\t\t\tshow: true,\n\t\t\t},\n\t\t\te,\n\t\t);\n\n\t\tthis.setState(\n\t\t\t{\n\t\t\t\txScale,\n\t\t\t\tplotData,\n\t\t\t\tchartConfig,\n\t\t\t},\n\t\t\t() => {\n\t\t\t\tif (start < end) {\n\t\t\t\t\tonLoadMore(start, end);\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\txAxisZoom(newDomain) {\n\t\tconst { xScale, plotData, chartConfig } = this.calculateStateForDomain(newDomain);\n\t\tthis.clearThreeCanvas();\n\n\t\tconst { xAccessor } = this.state;\n\t\tconst { fullData } = this;\n\t\tconst firstItem = head(fullData);\n\t\tconst start = head(xScale.domain());\n\t\tconst end = xAccessor(firstItem);\n\t\tconst { onLoadMore } = this.props;\n\n\t\tthis.setState(\n\t\t\t{\n\t\t\t\txScale,\n\t\t\t\tplotData,\n\t\t\t\tchartConfig,\n\t\t\t},\n\t\t\t() => {\n\t\t\t\tif (start < end) onLoadMore(start, end);\n\t\t\t},\n\t\t);\n\t}\n\tyAxisZoom(chartId, newDomain) {\n\t\tthis.clearThreeCanvas();\n\t\tconst { chartConfig: initialChartConfig } = this.state;\n\t\tconst chartConfig = initialChartConfig.map(each => {\n\t\t\tif (each.id === chartId) {\n\t\t\t\tconst { yScale } = each;\n\t\t\t\treturn {\n\t\t\t\t\t...each,\n\t\t\t\t\tyScale: yScale.copy().domain(newDomain),\n\t\t\t\t\tyPanEnabled: true,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn each;\n\t\t\t}\n\t\t});\n\n\t\tthis.setState({\n\t\t\tchartConfig,\n\t\t});\n\t}\n\ttriggerEvent(type, props, e) {\n\t\t// console.log(\"triggering ->\", type);\n\n\t\tthis.subscriptions.forEach(each => {\n\t\t\tconst state = {\n\t\t\t\t...this.state,\n\t\t\t\tfullData: this.fullData,\n\t\t\t\tsubscriptions: this.subscriptions,\n\t\t\t};\n\t\t\teach.listener(type, props, state, e);\n\t\t});\n\t}\n\tdraw(props) {\n\t\tthis.subscriptions.forEach(each => {\n\t\t\tif (isDefined(each.draw)) each.draw(props);\n\t\t});\n\t}\n\tredraw() {\n\t\tthis.clearThreeCanvas();\n\t\tthis.draw({ force: true });\n\t}\n\tpanHelper(mouseXY, initialXScale, { dx, dy }, chartsToPan) {\n\t\tconst { xAccessor, displayXAccessor, chartConfig: initialChartConfig } = this.state;\n\t\tconst { filterData } = this.state;\n\t\tconst { fullData } = this;\n\t\tconst { postCalculator } = this.props;\n\n\t\t// console.log(dx, dy);\n\t\tif (isNotDefined(initialXScale.invert))\n\t\t\tthrow new Error(\n\t\t\t\t\"xScale provided does not have an invert() method.\" +\n\t\t\t\t\t\"You are likely using an ordinal scale. This scale does not support zoom, pan\",\n\t\t\t);\n\n\t\tconst newDomain = initialXScale\n\t\t\t.range()\n\t\t\t.map(x => x - dx)\n\t\t\t.map(initialXScale.invert);\n\n\t\tconst { plotData: beforePlotData, domain } = filterData(\n\t\t\tfullData,\n\t\t\tnewDomain,\n\t\t\txAccessor,\n\t\t\tinitialXScale,\n\t\t\t{\n\t\t\t\tcurrentPlotData: this.hackyWayToStopPanBeyondBounds__plotData,\n\t\t\t\tcurrentDomain: this.hackyWayToStopPanBeyondBounds__domain,\n\t\t\t},\n\t\t);\n\n\t\tconst updatedScale = initialXScale.copy().domain(domain);\n\t\tconst plotData = postCalculator(beforePlotData);\n\t\t// console.log(last(plotData));\n\n\t\tconst currentItem = getCurrentItem(updatedScale, xAccessor, mouseXY, plotData);\n\t\tconst chartConfig = getChartConfigWithUpdatedYScales(\n\t\t\tinitialChartConfig,\n\t\t\t{ plotData, xAccessor, displayXAccessor, fullData },\n\t\t\tupdatedScale.domain(),\n\t\t\tdy,\n\t\t\tchartsToPan,\n\t\t);\n\t\tconst currentCharts = getCurrentCharts(chartConfig, mouseXY);\n\n\t\t// console.log(initialXScale.domain(), newDomain, updatedScale.domain());\n\t\treturn {\n\t\t\txScale: updatedScale,\n\t\t\tplotData,\n\t\t\tchartConfig,\n\t\t\tmouseXY,\n\t\t\tcurrentCharts,\n\t\t\tcurrentItem,\n\t\t};\n\t}\n\thandlePan(mousePosition, panStartXScale, dxdy, chartsToPan, e) {\n\t\tif (!this.waitingForPanAnimationFrame) {\n\t\t\tthis.waitingForPanAnimationFrame = true;\n\n\t\t\tthis.hackyWayToStopPanBeyondBounds__plotData =\n\t\t\t\tthis.hackyWayToStopPanBeyondBounds__plotData || this.state.plotData;\n\t\t\tthis.hackyWayToStopPanBeyondBounds__domain =\n\t\t\t\tthis.hackyWayToStopPanBeyondBounds__domain || this.state.xScale.domain();\n\n\t\t\tconst state = this.panHelper(mousePosition, panStartXScale, dxdy, chartsToPan);\n\n\t\t\tthis.hackyWayToStopPanBeyondBounds__plotData = state.plotData;\n\t\t\tthis.hackyWayToStopPanBeyondBounds__domain = state.xScale.domain();\n\n\t\t\tthis.panInProgress = true;\n\t\t\t// console.log(panStartXScale.domain(), state.xScale.domain());\n\n\t\t\tthis.triggerEvent(\"pan\", state, e);\n\n\t\t\tthis.mutableState = {\n\t\t\t\tmouseXY: state.mouseXY,\n\t\t\t\tcurrentItem: state.currentItem,\n\t\t\t\tcurrentCharts: state.currentCharts,\n\t\t\t};\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tthis.waitingForPanAnimationFrame = false;\n\t\t\t\tthis.clearBothCanvas();\n\t\t\t\tthis.draw({ trigger: \"pan\" });\n\t\t\t});\n\t\t}\n\t}\n\thandlePanEnd(mousePosition, panStartXScale, dxdy, chartsToPan, e) {\n\t\tconst state = this.panHelper(mousePosition, panStartXScale, dxdy, chartsToPan);\n\t\t// console.log(this.canvasDrawCallbackList.map(d => d.type));\n\t\tthis.hackyWayToStopPanBeyondBounds__plotData = null;\n\t\tthis.hackyWayToStopPanBeyondBounds__domain = null;\n\n\t\tthis.panInProgress = false;\n\n\t\t// console.log(\"PANEND\", panEnd++);\n\t\tconst { xScale, plotData, chartConfig } = state;\n\n\t\tthis.triggerEvent(\"panend\", state, e);\n\n\t\trequestAnimationFrame(() => {\n\t\t\tconst { xAccessor } = this.state;\n\t\t\tconst { fullData } = this;\n\n\t\t\tconst firstItem = head(fullData);\n\t\t\tconst start = head(xScale.domain());\n\t\t\tconst end = xAccessor(firstItem);\n\t\t\t// console.log(start, end, start < end ? \"Load more\" : \"I have it\");\n\n\t\t\tconst { onLoadMore } = this.props;\n\n\t\t\tthis.clearThreeCanvas();\n\n\t\t\tthis.setState(\n\t\t\t\t{\n\t\t\t\t\txScale,\n\t\t\t\t\tplotData,\n\t\t\t\t\tchartConfig,\n\t\t\t\t},\n\t\t\t\t() => {\n\t\t\t\t\tif (start < end) onLoadMore(start, end);\n\t\t\t\t},\n\t\t\t);\n\t\t});\n\t}\n\thandleMouseDown(mousePosition, currentCharts, e) {\n\t\tthis.triggerEvent(\"mousedown\", this.mutableState, e);\n\t}\n\thandleMouseEnter(e) {\n\t\tthis.triggerEvent(\n\t\t\t\"mouseenter\",\n\t\t\t{\n\t\t\t\tshow: true,\n\t\t\t},\n\t\t\te,\n\t\t);\n\t}\n\thandleMouseMove(mouseXY, inputType, e) {\n\t\tif (!this.waitingForMouseMoveAnimationFrame) {\n\t\t\tthis.waitingForMouseMoveAnimationFrame = true;\n\n\t\t\tconst { chartConfig, plotData, xScale, xAccessor } = this.state;\n\t\t\tconst currentCharts = getCurrentCharts(chartConfig, mouseXY);\n\t\t\tconst currentItem = getCurrentItem(xScale, xAccessor, mouseXY, plotData);\n\t\t\tthis.triggerEvent(\n\t\t\t\t\"mousemove\",\n\t\t\t\t{\n\t\t\t\t\tshow: true,\n\t\t\t\t\tmouseXY,\n\t\t\t\t\t// prevMouseXY is used in interactive components\n\t\t\t\t\tprevMouseXY: this.prevMouseXY,\n\t\t\t\t\tcurrentItem,\n\t\t\t\t\tcurrentCharts,\n\t\t\t\t},\n\t\t\t\te,\n\t\t\t);\n\n\t\t\tthis.prevMouseXY = mouseXY;\n\t\t\tthis.mutableState = {\n\t\t\t\tmouseXY,\n\t\t\t\tcurrentItem,\n\t\t\t\tcurrentCharts,\n\t\t\t};\n\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tthis.clearMouseCanvas();\n\t\t\t\tthis.draw({ trigger: \"mousemove\" });\n\t\t\t\tthis.waitingForMouseMoveAnimationFrame = false;\n\t\t\t});\n\t\t}\n\t}\n\thandleMouseLeave(e) {\n\t\tthis.triggerEvent(\"mouseleave\", { show: false }, e);\n\t\tthis.clearMouseCanvas();\n\t\tthis.draw({ trigger: \"mouseleave\" });\n\t}\n\thandleDragStart({ startPos }, e) {\n\t\tthis.triggerEvent(\"dragstart\", { startPos }, e);\n\t}\n\thandleDrag({ startPos, mouseXY }, e) {\n\t\tconst { chartConfig, plotData, xScale, xAccessor } = this.state;\n\t\tconst currentCharts = getCurrentCharts(chartConfig, mouseXY);\n\t\tconst currentItem = getCurrentItem(xScale, xAccessor, mouseXY, plotData);\n\n\t\tthis.triggerEvent(\n\t\t\t\"drag\",\n\t\t\t{\n\t\t\t\tstartPos,\n\t\t\t\tmouseXY,\n\t\t\t\tcurrentItem,\n\t\t\t\tcurrentCharts,\n\t\t\t},\n\t\t\te,\n\t\t);\n\n\t\tthis.mutableState = {\n\t\t\tmouseXY,\n\t\t\tcurrentItem,\n\t\t\tcurrentCharts,\n\t\t};\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis.clearMouseCanvas();\n\t\t\tthis.draw({ trigger: \"drag\" });\n\t\t});\n\t}\n\thandleDragEnd({ mouseXY }, e) {\n\t\tthis.triggerEvent(\"dragend\", { mouseXY }, e);\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis.clearMouseCanvas();\n\t\t\tthis.draw({ trigger: \"dragend\" });\n\t\t});\n\t}\n\thandleClick(mousePosition, e) {\n\t\tthis.triggerEvent(\"click\", this.mutableState, e);\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis.clearMouseCanvas();\n\t\t\tthis.draw({ trigger: \"click\" });\n\t\t});\n\t}\n\thandleDoubleClick(mousePosition, e) {\n\t\tthis.triggerEvent(\"dblclick\", {}, e);\n\t}\n\tgetChildContext() {\n\t\tconst dimensions = getDimensions(this.props);\n\t\treturn {\n\t\t\tfullData: this.fullData,\n\t\t\tplotData: this.state.plotData,\n\t\t\twidth: dimensions.width,\n\t\t\theight: dimensions.height,\n\t\t\tchartConfig: this.state.chartConfig,\n\t\t\txScale: this.state.xScale,\n\t\t\txAccessor: this.state.xAccessor,\n\t\t\tdisplayXAccessor: this.state.displayXAccessor,\n\t\t\tchartCanvasType: this.props.type,\n\t\t\tmargin: this.props.margin,\n\t\t\tratio: this.props.ratio,\n\t\t\txAxisZoom: this.xAxisZoom,\n\t\t\tyAxisZoom: this.yAxisZoom,\n\t\t\tgetCanvasContexts: this.getCanvasContexts,\n\t\t\tredraw: this.redraw,\n\t\t\tsubscribe: this.subscribe,\n\t\t\tunsubscribe: this.unsubscribe,\n\t\t\tgenerateSubscriptionId: this.generateSubscriptionId,\n\t\t\tgetMutableState: this.getMutableState,\n\t\t\tamIOnTop: this.amIOnTop,\n\t\t\tsetCursorClass: this.setCursorClass,\n\t\t};\n\t}\n\tcomponentWillMount() {\n\t\tconst { fullData, ...state } = resetChart(this.props, true);\n\t\tthis.setState(state);\n\t\tthis.fullData = fullData;\n\t}\n\tcomponentWillReceiveProps(nextProps) {\n\t\tconst reset = shouldResetChart(this.props, nextProps);\n\n\t\tconst interaction = isInteractionEnabled(\n\t\t\tthis.state.xScale,\n\t\t\tthis.state.xAccessor,\n\t\t\tthis.state.plotData,\n\t\t);\n\t\tconst { chartConfig: initialChartConfig } = this.state;\n\n\t\tlet newState;\n\t\tif (!interaction || reset || !shallowEqual(this.props.xExtents, nextProps.xExtents)) {\n\t\t\tif (process.env.NODE_ENV !== \"production\") {\n\t\t\t\tif (!interaction) log(\"RESET CHART, changes to a non interactive chart\");\n\t\t\t\telse if (reset)\n\t\t\t\t\tlog(\"RESET CHART, one or more of these props changed\", CANDIDATES_FOR_RESET);\n\t\t\t\telse log(\"xExtents changed\");\n\t\t\t}\n\t\t\t// do reset\n\t\t\tnewState = resetChart(nextProps);\n\t\t} else {\n\t\t\tconst [start, end] = this.state.xScale.domain();\n\t\t\tconst prevLastItem = last(this.fullData);\n\n\t\t\tconst calculatedState = calculateFullData(nextProps);\n\t\t\tconst { xAccessor } = calculatedState;\n\t\t\tconst lastItemWasVisible =\n\t\t\t\txAccessor(prevLastItem) <= end && xAccessor(prevLastItem) >= start;\n\n\t\t\tif (process.env.NODE_ENV !== \"production\") {\n\t\t\t\tif (this.props.data !== nextProps.data)\n\t\t\t\t\tlog(\n\t\t\t\t\t\t\"data is changed but seriesName did not, change the seriesName if you wish to reset the chart and lastItemWasVisible = \",\n\t\t\t\t\t\tlastItemWasVisible,\n\t\t\t\t\t);\n\t\t\t\telse\n\t\t\t\t\tlog(\n\t\t\t\t\t\t\"Trivial change, may be width/height or type changed, but that does not matter\",\n\t\t\t\t\t);\n\t\t\t}\n\n\t\t\tnewState = updateChart(\n\t\t\t\tcalculatedState,\n\t\t\t\tthis.state.xScale,\n\t\t\t\tnextProps,\n\t\t\t\tlastItemWasVisible,\n\t\t\t\tinitialChartConfig,\n\t\t\t);\n\t\t}\n\n\t\tconst { fullData, ...state } = newState;\n\n\t\tif (this.panInProgress) {\n\t\t\tif (process.env.NODE_ENV !== \"production\") {\n\t\t\t\tlog(\"Pan is in progress\");\n\t\t\t}\n\t\t} else {\n\t\t\t/*\n\t\t\tif (!reset) {\n\t\t\t\tstate.chartConfig\n\t\t\t\t\t.forEach((each) => {\n\t\t\t\t\t\t// const sourceChartConfig = initialChartConfig.filter(d => d.id === each.id);\n\t\t\t\t\t\tconst prevChartConfig = find(initialChartConfig, d => d.id === each.id);\n\t\t\t\t\t\tif (isDefined(prevChartConfig) && prevChartConfig.yPanEnabled) {\n\t\t\t\t\t\t\teach.yScale.domain(prevChartConfig.yScale.domain());\n\t\t\t\t\t\t\teach.yPanEnabled = prevChartConfig.yPanEnabled;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\t\t\t*/\n\t\t\tthis.clearThreeCanvas();\n\n\t\t\tthis.setState(state);\n\t\t}\n\t\tthis.fullData = fullData;\n\t}\n\t/*\n\tcomponentDidUpdate(prevProps, prevState) {\n\t\tconsole.error(this.state.chartConfig, this.state.chartConfig.map(d => d.yScale.domain()));\n\t}\n\t*/\n\tresetYDomain(chartId) {\n\t\tconst { chartConfig } = this.state;\n\t\tlet changed = false;\n\t\tconst newChartConfig = chartConfig.map(each => {\n\t\t\tif (\n\t\t\t\t(isNotDefined(chartId) || each.id === chartId) &&\n\t\t\t\t!shallowEqual(each.yScale.domain(), each.realYDomain)\n\t\t\t) {\n\t\t\t\tchanged = true;\n\t\t\t\treturn {\n\t\t\t\t\t...each,\n\t\t\t\t\tyScale: each.yScale.domain(each.realYDomain),\n\t\t\t\t\tyPanEnabled: false,\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn each;\n\t\t});\n\n\t\tif (changed) {\n\t\t\tthis.clearThreeCanvas();\n\t\t\tthis.setState({\n\t\t\t\tchartConfig: newChartConfig,\n\t\t\t});\n\t\t}\n\t}\n\tshouldComponentUpdate() {\n\t\t// console.log(\"Happneing.....\", !this.panInProgress)\n\t\treturn !this.panInProgress;\n\t}\n\trender() {\n\t\tconst {\n\t\t\ttype,\n\t\t\theight,\n\t\t\twidth,\n\t\t\tmargin,\n\t\t\tclassName,\n\t\t\tzIndex,\n\t\t\tdefaultFocus,\n\t\t\tratio,\n\t\t\tmouseMoveEvent,\n\t\t\tpanEvent,\n\t\t\tzoomEvent,\n\t\t\tgradientColor,\n\t\t} = this.props;\n\t\tconst { useCrossHairStyleCursor, onSelect } = this.props;\n\n\t\tconst { plotData, xScale, xAccessor, chartConfig } = this.state;\n\t\tconst dimensions = getDimensions(this.props);\n\n\t\tconst interaction = isInteractionEnabled(xScale, xAccessor, plotData);\n\n\t\tconst cursorStyle = useCrossHairStyleCursor && interaction;\n\t\tconst cursor = getCursorStyle();\n\t\treturn (\n\t\t\t<div\n\t\t\t\tstyle={{ position: \"relative\", width, height }}\n\t\t\t\tclassName={className}\n\t\t\t\tonClick={onSelect}\n\t\t\t>\n\t\t\t\t<CanvasContainer\n\t\t\t\t\tref={this.saveCanvasContainerNode}\n\t\t\t\t\ttype={type}\n\t\t\t\t\tratio={ratio}\n\t\t\t\t\twidth={width}\n\t\t\t\t\theight={height}\n\t\t\t\t\tzIndex={zIndex}\n\t\t\t\t/>\n\t\t\t\t<svg\n\t\t\t\t\tclassName={className}\n\t\t\t\t\twidth={width}\n\t\t\t\t\theight={height}\n\t\t\t\t\tstyle={{ position: \"absolute\", zIndex: zIndex + 5 }}\n\t\t\t\t>\n\t\t\t\t\t{cursor}\n\t\t\t\t\t<defs>\n\t\t\t\t\t\t<clipPath id=\"chart-area-clip\">\n\t\t\t\t\t\t\t<rect x=\"0\" y=\"0\" width={dimensions.width} height={dimensions.height} />\n\t\t\t\t\t\t</clipPath>\n\t\t\t\t\t\t<linearGradient id=\"gradient\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n\t\t\t\t\t\t\t<stop stopColor={gradientColor} stopOpacity=\"0.53\" offset=\"0%\" />\n\t\t\t\t\t\t\t<stop stopColor={gradientColor} stopOpacity=\"0.11\" offset=\"60%\" />\n\t\t\t\t\t\t\t<stop stopColor={gradientColor} stopOpacity=\"0\" offset=\"100%\" />\n\t\t\t\t\t\t</linearGradient>\n\t\t\t\t\t\t{chartConfig.map((each, idx) => (\n\t\t\t\t\t\t\t<clipPath key={idx} id={`chart-area-clip-${each.id}`}>\n\t\t\t\t\t\t\t\t<rect x=\"0\" y=\"0\" width={each.width} height={each.height} />\n\t\t\t\t\t\t\t</clipPath>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</defs>\n\t\t\t\t\t<g transform={`translate(${margin.left + 0.5}, ${margin.top + 0.5})`}>\n\t\t\t\t\t\t<EventCapture\n\t\t\t\t\t\t\tref={this.saveEventCaptureNode}\n\t\t\t\t\t\t\tuseCrossHairStyleCursor={cursorStyle}\n\t\t\t\t\t\t\tmouseMove={mouseMoveEvent && interaction}\n\t\t\t\t\t\t\tzoom={zoomEvent && interaction}\n\t\t\t\t\t\t\tpan={panEvent && interaction}\n\t\t\t\t\t\t\twidth={dimensions.width}\n\t\t\t\t\t\t\theight={dimensions.height}\n\t\t\t\t\t\t\tchartConfig={chartConfig}\n\t\t\t\t\t\t\txScale={xScale}\n\t\t\t\t\t\t\txAccessor={xAccessor}\n\t\t\t\t\t\t\tfocus={defaultFocus}\n\t\t\t\t\t\t\tdisableInteraction={this.props.disableInteraction}\n\t\t\t\t\t\t\tgetAllPanConditions={this.getAllPanConditions}\n\t\t\t\t\t\t\tonContextMenu={this.handleContextMenu}\n\t\t\t\t\t\t\tonClick={this.handleClick}\n\t\t\t\t\t\t\tonDoubleClick={this.handleDoubleClick}\n\t\t\t\t\t\t\tonMouseDown={this.handleMouseDown}\n\t\t\t\t\t\t\tonMouseMove={this.handleMouseMove}\n\t\t\t\t\t\t\tonMouseEnter={this.handleMouseEnter}\n\t\t\t\t\t\t\tonMouseLeave={this.handleMouseLeave}\n\t\t\t\t\t\t\tonDragStart={this.handleDragStart}\n\t\t\t\t\t\t\tonDrag={this.handleDrag}\n\t\t\t\t\t\t\tonDragComplete={this.handleDragEnd}\n\t\t\t\t\t\t\tonZoom={this.handleZoom}\n\t\t\t\t\t\t\tonPinchZoom={this.handlePinchZoom}\n\t\t\t\t\t\t\tonPinchZoomEnd={this.handlePinchZoomEnd}\n\t\t\t\t\t\t\tonPan={this.handlePan}\n\t\t\t\t\t\t\tonPanEnd={this.handlePanEnd}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<g className=\"react-stockcharts-avoid-interaction\">{this.props.children}</g>\n\t\t\t\t\t</g>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nfunction isInteractionEnabled(xScale, xAccessor, data) {\n\tconst interaction = !isNaN(xScale(xAccessor(head(data)))) && isDefined(xScale.invert);\n\treturn interaction;\n}\n\nChartCanvas.propTypes = {\n\twidth: PropTypes.number.isRequired,\n\theight: PropTypes.number.isRequired,\n\tmargin: PropTypes.object,\n\tratio: PropTypes.number.isRequired,\n\t// interval: PropTypes.oneOf([\"D\", \"W\", \"M\"]), // ,\"m1\", \"m5\", \"m15\", \"W\", \"M\"\n\ttype: PropTypes.oneOf([\"svg\", \"hybrid\"]),\n\tpointsPerPxThreshold: PropTypes.number,\n\tminPointsPerPxThreshold: PropTypes.number,\n\tdata: PropTypes.array.isRequired,\n\t// initialDisplay: PropTypes.number,\n\txAccessor: PropTypes.func,\n\txExtents: PropTypes.oneOfType([PropTypes.array, PropTypes.func]),\n\tzoomAnchor: PropTypes.func,\n\n\tclassName: PropTypes.string,\n\tseriesName: PropTypes.string.isRequired,\n\tzIndex: PropTypes.number,\n\tchildren: PropTypes.node.isRequired,\n\txScale: PropTypes.func.isRequired,\n\tpostCalculator: PropTypes.func,\n\tflipXScale: PropTypes.bool,\n\tuseCrossHairStyleCursor: PropTypes.bool,\n\tpadding: PropTypes.oneOfType([\n\t\tPropTypes.number,\n\t\tPropTypes.shape({\n\t\t\tleft: PropTypes.number,\n\t\t\tright: PropTypes.number,\n\t\t}),\n\t]),\n\tdefaultFocus: PropTypes.bool,\n\tzoomMultiplier: PropTypes.number,\n\tonLoadMore: PropTypes.func,\n\tdisplayXAccessor: function(props, propName /* , componentName */) {\n\t\tif (isNotDefined(props[propName])) {\n\t\t\tconsole.warn(\n\t\t\t\t\"`displayXAccessor` is not defined,\" +\n\t\t\t\t\t\" will use the value from `xAccessor` as `displayXAccessor`.\" +\n\t\t\t\t\t\" This might be ok if you do not use a discontinuous scale\" +\n\t\t\t\t\t\" but if you do, provide a `displayXAccessor` prop to `ChartCanvas`\",\n\t\t\t);\n\t\t} else if (typeof props[propName] !== \"function\") {\n\t\t\treturn new Error(\"displayXAccessor has to be a function\");\n\t\t}\n\t},\n\tmouseMoveEvent: PropTypes.bool,\n\tpanEvent: PropTypes.bool,\n\tclamp: PropTypes.oneOfType([PropTypes.string, PropTypes.bool, PropTypes.func]),\n\tzoomEvent: PropTypes.bool,\n\tonSelect: PropTypes.func,\n\tmaintainPointsPerPixelOnResize: PropTypes.bool,\n\tdisableInteraction: PropTypes.bool,\n};\n\nChartCanvas.defaultProps = {\n\tmargin: { top: 20, right: 30, bottom: 30, left: 80 },\n\ttype: \"hybrid\",\n\tpointsPerPxThreshold: 2,\n\tminPointsPerPxThreshold: 1 / 100,\n\tclassName: \"react-stockchart\",\n\tzIndex: 1,\n\txExtents: [min, max],\n\tpostCalculator: identity,\n\tpadding: 0,\n\txAccessor: identity,\n\tflipXScale: false,\n\tuseCrossHairStyleCursor: true,\n\tdefaultFocus: true,\n\tonLoadMore: noop,\n\tonSelect: noop,\n\tmouseMoveEvent: true,\n\tpanEvent: true,\n\tzoomEvent: true,\n\tzoomMultiplier: 1.1,\n\tclamp: false,\n\tzoomAnchor: mouseBasedZoomAnchor,\n\tmaintainPointsPerPixelOnResize: true,\n\t// ratio: 2,\n\tdisableInteraction: false,\n};\n\nChartCanvas.childContextTypes = {\n\tplotData: PropTypes.array,\n\tfullData: PropTypes.array,\n\tchartConfig: PropTypes.arrayOf(\n\t\tPropTypes.shape({\n\t\t\tid: PropTypes.oneOfType([PropTypes.number, PropTypes.string]).isRequired,\n\t\t\torigin: PropTypes.arrayOf(PropTypes.number).isRequired,\n\t\t\tpadding: PropTypes.oneOfType([\n\t\t\t\tPropTypes.number,\n\t\t\t\tPropTypes.shape({\n\t\t\t\t\ttop: PropTypes.number,\n\t\t\t\t\tbottom: PropTypes.number,\n\t\t\t\t}),\n\t\t\t]),\n\t\t\tyExtents: PropTypes.arrayOf(PropTypes.func),\n\t\t\tyExtentsProvider: PropTypes.func,\n\t\t\tyScale: PropTypes.func.isRequired,\n\t\t\tmouseCoordinates: PropTypes.shape({\n\t\t\t\tat: PropTypes.string,\n\t\t\t\tformat: PropTypes.func,\n\t\t\t}),\n\t\t\twidth: PropTypes.number.isRequired,\n\t\t\theight: PropTypes.number.isRequired,\n\t\t}),\n\t).isRequired,\n\txScale: PropTypes.func.isRequired,\n\txAccessor: PropTypes.func.isRequired,\n\tdisplayXAccessor: PropTypes.func.isRequired,\n\twidth: PropTypes.number.isRequired,\n\theight: PropTypes.number.isRequired,\n\tchartCanvasType: PropTypes.oneOf([\"svg\", \"hybrid\"]).isRequired,\n\tmargin: PropTypes.object.isRequired,\n\tratio: PropTypes.number.isRequired,\n\tgetCanvasContexts: PropTypes.func,\n\txAxisZoom: PropTypes.func,\n\tyAxisZoom: PropTypes.func,\n\tamIOnTop: PropTypes.func,\n\tredraw: PropTypes.func,\n\tsubscribe: PropTypes.func,\n\tunsubscribe: PropTypes.func,\n\tsetCursorClass: PropTypes.func,\n\tgenerateSubscriptionId: PropTypes.func,\n\tgetMutableState: PropTypes.func,\n};\n\nChartCanvas.ohlcv = d => ({\n\tdate: d.date,\n\topen: d.open,\n\thigh: d.high,\n\tlow: d.low,\n\tclose: d.close,\n\tvolume: d.volume,\n});\n\nexport default ChartCanvas;\n"]}